{"version":3,"file":"js/57.7d154cb0.js","mappings":"sMAwESA,MAAM,qB,GACPC,EAAAA,EAAAA,GAAsE,MAAlED,MAAM,yCAAwC,mBAAe,G,SAE7CA,MAAM,sD,GACtBC,EAAAA,EAAAA,GAAwE,OAAnED,MAAM,YAAU,EAACC,EAAAA,EAAAA,GAAW,QAAAA,EAAAA,EAAAA,GAAW,QAAAA,EAAAA,EAAAA,GAAW,QAAAA,EAAAA,EAAAA,GAAW,Y,GAK7DC,IAAI,S,SAGRF,MAAM,oB,0CAZfG,EAAAA,EAAAA,IAoBM,MApBNC,EAoBM,CAnBFC,EAEWC,EAAAC,UAAO,WAAlBJ,EAAAA,EAAAA,IAGM,MAHNK,EAGM,CAFFC,GAAwE,0BAE5E,eAEYH,EAAAC,SACS,iBADF,WAAnBJ,EAAAA,EAAAA,IAEM,O,MAFeH,OAAKU,EAAAA,EAAAA,IAAA,CAAC,0DAAyD,CAAAC,SAAoBL,EAAAM,gB,EACpGX,EAAAA,EAAAA,GAAiB,MAAjBY,EAAiB,eAGgBP,EAAAC,SAM2B,iBANpB,WAA5CJ,EAAAA,EAAAA,IAOM,MAPNW,EAOM,CANyCR,EAAAM,cAAW,WAAtDT,EAAAA,EAAAA,IACyE,U,MADhEY,QAAKC,EAAA,KAAAA,EAAA,GAAAC,GAAEX,EAAAM,aAAc,GAC1BZ,MAAM,6CAA4C,gBAAU,eACjCM,EAAAM,aACqC,iBAD1B,WAA1CT,EAAAA,EAAAA,IAC6E,U,MADpEY,QAAKC,EAAA,KAAAA,EAAA,GAAAC,GAAEC,EAAAC,QACZnB,MAAM,kDAAiD,cAChBM,EAAAM,aACiB,iBADN,WAAtDT,EAAAA,EAAAA,IACqE,U,MAD5DY,QAAKC,EAAA,KAAAA,EAAA,GAAAC,GAAEX,EAAAM,aAAc,GAC1BZ,MAAM,6CAA4C,e,uBAvFlE,GACIoB,OACI,MAAO,CACHC,WAAY,KACZC,MAAO,KACPV,aAAa,EACbL,SAAS,EAEjB,EACAgB,UACIC,QAAQC,IAAI,aAAaC,KAAKC,QAC1BD,KAAKC,OAAOC,MACZF,KAAKG,QAAQC,KAAK,CAAEC,KAAM,cAI9BL,KAAKM,SACT,EACAC,YACGP,KAAKQ,YACR,EACAC,SAAU,CACNC,aACI,OAAOV,KAAKW,OAAOC,MAAMF,UAC7B,EACAT,SACI,OAAOD,KAAKW,OAAOC,MAAMX,QAAU,CAAC,CACxC,GAEJY,QAAS,CACLpB,OACI,MAAMqB,EAAS,IAAIC,WACnBD,EAAOE,cAAchB,KAAKJ,OAC1BkB,EAAOG,UAAY,MACfC,EAAAA,EAAAA,IAAelB,KAAKC,QAAQkB,QAASL,EAAOM,OAAOC,MAAM,KAAK,GAAG,EAGrErB,KAAKG,QAAQC,KAAK,CAAEC,KAAM,aAC9B,EACAC,UACIN,KAAKL,WAAa,IAAI2B,UAAU,6BAEhCtB,KAAKL,WAAW4B,UAAaC,IACzB,GAAIxB,KAAKd,YAAa,CAClBc,KAAKnB,SAAU,EACf,MAAMa,EAAO8B,EAAM9B,KACb+B,EAAMC,IAAIC,gBAAgBjC,GAChCM,KAAK4B,MAAMC,MAAMC,IAAML,EACvBzB,KAAKJ,MAAQF,CACjB,GAGJM,KAAKL,WAAWoC,OAAUP,IACtB1B,QAAQC,IAAI,yDAAyD,EAGzEC,KAAKL,WAAWqC,MAASA,IACrBlC,QAAQC,IAAIiC,EAAM,CAE1B,EACAC,mBACInC,QAAQC,IAAI,oCACNmC,EAAAA,EAAAA,KACV,I,QC7DR,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,KAEpE,O","sources":["webpack://sdpo-frontend/./src/pages/inspection/Step-photo.vue","webpack://sdpo-frontend/./src/pages/inspection/Step-photo.vue?04a5"],"sourcesContent":["<script>\r\nimport { setDriverPhoto, closeDriverPhoto } from '@/helpers/api';\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            connection: null,\r\n            image: null,\r\n            translation: true,\r\n            loading: true,\r\n        }\r\n    },\r\n    mounted() {\r\n        console.log('asdasdads ',this.driver);\r\n        if (this.driver.photo) {\r\n            this.$router.push({ name: 'step-ride' });\r\n            return;\r\n        }\r\n\r\n        this.connect();\r\n    },\r\n    unmounted() {\r\n       this.disconnect();\r\n    },\r\n    computed: {\r\n        inspection() {\r\n            return this.$store.state.inspection;\r\n        },\r\n        driver() {\r\n            return this.$store.state.driver ?? {};\r\n        }\r\n    },\r\n    methods: {\r\n        next() {\r\n            const reader = new FileReader();\r\n            reader.readAsDataURL(this.image); \r\n            reader.onloadend = () => {\r\n                setDriverPhoto(this.driver?.hash_id, reader.result.split(',')[1]);\r\n            }\r\n\r\n            this.$router.push({ name: 'step-ride' })\r\n        },\r\n        connect() {\r\n            this.connection = new WebSocket(\"ws://localhost:8080/video\")\r\n\r\n            this.connection.onmessage = (event) => {\r\n                if (this.translation) {\r\n                    this.loading = false;\r\n                    const data = event.data;\r\n                    const img = URL.createObjectURL(data);\r\n                    this.$refs.video.src = img;\r\n                    this.image = data;\r\n                }\r\n            }\r\n\r\n            this.connection.onopen = (event) => {\r\n                console.log(\"Successfully connected to the echo websocket server...\")\r\n            }\r\n            \r\n            this.connection.error = (error) => {\r\n                console.log(error);\r\n            }\r\n        },\r\n        async disconnect() {\r\n            console.log('Disconnect websoket server');\r\n            await closeDriverPhoto();\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div class=\"step-photo__outer\">\r\n        <h3 class=\"animate__animated animate__fadeInDown\">Сделайте снимок</h3>\r\n\r\n        <div v-if=\"loading\" class=\"admin__loading animate__animated animate__fadeInUp\">\r\n            <div class=\"lds-ring\"><div></div><div></div><div></div><div></div></div> \r\n            Загрузка\r\n        </div>\r\n\r\n        <div v-if=\"!loading\" class=\"step-photo__video animate__animated animate__fadeInDown\" :class=\"{preview: !translation}\">\r\n            <img ref=\"video\">\r\n        </div>\r\n\r\n        <div class=\"step-photo__btns\" v-if=\"!loading\">\r\n            <button @click=\"translation = false\" v-if=\"translation\"\r\n                class=\"btn animate__animated animate__fadeInDown\">Фотография</button> \r\n            <button @click=\"next()\" v-if=\"!translation\"\r\n                class=\"btn blue animate__animated animate__fadeInDown\">Сохранить</button> \r\n            <button @click=\"translation = true\" v-if=\"!translation\"\r\n                class=\"btn animate__animated animate__fadeInDown\">Отмена</button> \r\n        </div>\r\n    </div>\r\n</template>","import { render } from \"./Step-photo.vue?vue&type=template&id=7f72b2e0\"\nimport script from \"./Step-photo.vue?vue&type=script&lang=js\"\nexport * from \"./Step-photo.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\sdpo\\\\sdpo-java-main\\\\sdpo-java-main\\\\src\\\\main\\\\frontend\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","_createElementVNode","ref","_createElementBlock","_hoisted_1","_hoisted_2","$data","loading","_hoisted_3","_hoisted_4","_normalizeClass","preview","translation","_hoisted_5","_hoisted_6","onClick","_cache","$event","$options","next","data","connection","image","mounted","console","log","this","driver","photo","$router","push","name","connect","unmounted","disconnect","computed","inspection","$store","state","methods","reader","FileReader","readAsDataURL","onloadend","setDriverPhoto","hash_id","result","split","WebSocket","onmessage","event","img","URL","createObjectURL","$refs","video","src","onopen","error","async","closeDriverPhoto","__exports__","render"],"sourceRoot":""}