"use strict";(self["webpackChunksdpo_frontend"]=self["webpackChunksdpo_frontend"]||[]).push([[782],{2419:function(t,e,s){s.d(e,{NO:function(){return o},QL:function(){return c},TQ:function(){return r},af:function(){return n},o:function(){return d}});var a=s(1857),i=s(8791);async function n(){return await axios.post("device/photo").then((({data:t})=>t)).catch(a.i)}async function r(){return await axios.get("device/video/size").then((({data:t})=>t)).catch(a.i)}async function o(t){return await axios.post("device/media",{driver_id:t}).then((({data:t})=>((0,i.S)(),t))).catch(a.i)}async function c(t){return await axios.post("device/media/stop",{driver_id:t}).then((({data:t})=>t)).catch(a.i)}async function d(){return await axios.post("device/video/test").then((({data:t})=>t)).catch(a.i)}},8791:function(t,e,s){s.d(e,{E:function(){return n},S:function(){return r}});var a=s.p+"media/alert.1cca9e8e.ogg",i=s(7625);function n(){new Audio(a).play()}function r(){let t=15;i.Z.state.waitRecordMedia=!0;let e=setInterval((()=>{t--,console.log("осталось "+t),t<1&&(i.Z.state.waitRecordMedia=!1,clearInterval(e))}),1e3)}},5092:function(t,e,s){s.r(e),s.d(e,{default:function(){return W}});var a=s(3396),i=s(7139),n=s.p+"img/alco_guide.a6a48b74.png",r=s.p+"img/alco_guide_2.a5bbcd2d.png";const o={class:"step-alcometer__outer"},c={key:0,class:"step-alcometer"},d=(0,a._)("h3",{class:"animate__animated animate__fadeInDown"},"Проверка на алкоголь",-1),l={class:"step-alcometer__items"},u=(0,a._)("div",{class:"step-alcometer__item animate__animated animate__fadeInUp d-1"},[(0,a._)("span",null,"1"),(0,a._)("img",{style:{"padding-right":"20px"},width:"100",src:n}),(0,a._)("label",null,"Проверьте, что вставлена воронка")],-1),h=(0,a._)("div",{class:"step-alcometer__item animate__animated animate__fadeInUp d-2"},[(0,a._)("span",null,"2"),(0,a._)("img",{width:"100",src:r}),(0,a.Uk)(" Держите алкотестер на расстоянии 2-3 см от рта ")],-1),m={class:"step-alcometer__text animate__animated animate__fadeInUp d-2"},p=(0,a._)("br",null,null,-1),_=(0,a._)("br",null,null,-1),y=(0,a._)("br",null,null,-1),v=(0,a._)("br",null,null,-1),w=(0,a._)("br",null,null,-1),b={key:0},f={key:1,style:{width:"100%"}},k={key:0,class:"alert red"},g=(0,a._)("i",{class:"ri-alarm-warning-fill"},null,-1),I={key:1,class:"step-alcometer"},R=(0,a.uE)('<h3 class="animate__animated animate__fadeInDown">Количественное определение алкоголя</h3><div class="step-alcometer__items"><div class="step-alcometer__item animate__animated animate__fadeInUp d-1"><span style="min-height:30px;">3</span><img style="padding-right:20px;" width="100" src="'+n+'"> Снимите воронку , установите мундштук </div><div class="step-alcometer__text animate__animated animate__fadeInUp d-2"> Снимите мундштук-воронка<br><br> Установите индивидуальный мундштук<br><br> Дождитесь ГОТОВ на экране алкометра<br><br> Начните дуть с умеренной силой до окончания<br> звукового сигнала.<br><br> Снимите индивидуальный мундштук<br><br> Установите мундштук-воронка<br><br></div></div>',2),S=[R],x={class:"step-buttons"};function C(t,e,s,n,r,R){return(0,a.wg)(),(0,a.iD)("div",o,[r.showRetry?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",c,[d,(0,a._)("div",l,[u,h,(0,a._)("div",m,[(0,a.Uk)(" Дождитесь ГОТОВ на экране алкометра"),p,_,(0,a.Uk)(" Начните дуть с умеренной силой до окончания"),y,(0,a.Uk)(" звукового сигнала."),v,w,r.needRetry?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("p",b,"Дуйте "+(0,i.zw)(R.status),1)),r.needRetry?((0,a.wg)(),(0,a.iD)("p",f,"Результат: Положительный")):(0,a.kq)("",!0)])]),r.showRetry?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("p",k,[g,(0,a.Uk)(" НЕ ПРИКАСАТЬСЯ К АЛКОТЕСТЕРУ ГУБАМИ ")]))])),r.showRetry?((0,a.wg)(),(0,a.iD)("div",I,S)):(0,a.kq)("",!0),(0,a._)("div",x,[(0,a._)("button",{onClick:e[0]||(e[0]=t=>R.prevStep()),class:"btn opacity blue"},"Назад"),JSON.parse(R.system.alcometer_skip)?((0,a.wg)(),(0,a.iD)("button",{key:0,onClick:e[1]||(e[1]=t=>R.nextStep()),class:"btn"},"Продолжить")):(0,a.kq)("",!0)])])}s(7658);var A=s(6700),U=s(2419),q={data(){return{interval:null,seconds:5,needRetry:!1,showRetry:!1,statusAlcometer:""}},methods:{async runWebCam(){if(JSON.parse(this.system.camera_photo)&&!this.inspection.photo||JSON.parse(this.system.camera_video)&&!this.inspection.video){const t=await(0,U.NO)(this.$store.state.inspection.driver_id);this.inspection.photo=t?.photo,this.inspection.video=t?.video}},async stopWebCam(){await(0,U.QL)(this.$store.state.inspection.driver_id),this.inspection.photo=null,this.inspection.video=null},async nextStep(){this.$router.push({name:"step-sleep"})},async prevStep(){this.$router.push({name:"step-thermometer"})},async retry(){this.needRetry=!0,setTimeout((()=>{this.showRetry=!0}),3e3),await this.stopWebCam(),await(0,A.bP)(),await(0,A._L)(),this.runCountdown()},hasResult(t){return!(void 0===t||null===t||"next"===t)},needStartMedia(t){return"ready"===t&&"ready"!==this.statusAlcometer||this.hasError(t)},hasError(t){return"error"===t},checkReady(t){return"ready"===t},checkRetry(t){return this.system.alcometer_fast&&this.system.alcometer_retry&&Number(t)>0&&!this.needRetry},runCountdown(){this.seconds=5,this.timerInterval=setInterval((()=>{this.seconds--,this.seconds<1&&clearInterval(this.timerInterval)}),1e3)},setStatusAlcometerIsReady(){this.statusAlcometer="ready"},resetStatusAlcometerIsReady(){this.statusAlcometer=""}},async mounted(){await this.runWebCam(),this.runCountdown(),this.requestInterval=setInterval((async()=>{const t=await(0,A.pe)();if(this.hasResult(t))return this.needStartMedia(t)?(await this.stopWebCam(),await this.runWebCam(),void(this.checkReady(t)?this.setStatusAlcometerIsReady():this.resetStatusAlcometerIsReady())):void(this.checkReady(t)?this.setStatusAlcometerIsReady():(this.resetStatusAlcometerIsReady(),this.checkRetry(t)?await this.retry():(this.inspection.alcometer_result=Number(t)||0,this.inspection.alcometer_mode=this.system.alcometer_fast?"0":"1",this.nextStep())))}),1e3)},unmounted(){(0,A.qL)(this.system.alcometer_fast),clearInterval(this.requestInterval),clearInterval(this.timerInterval)},computed:{inspection(){return this.$store.state.inspection},system(){return this.$store.state.config?.system||{}},status(){return 5===this.seconds?"через "+this.seconds+" секунд":1===this.seconds?"через "+this.seconds+" секунду":this.seconds<1?" прямо сейчас!":"через "+this.seconds+" секунды"}}},D=s(89);const N=(0,D.Z)(q,[["render",C]]);var W=N}}]);
//# sourceMappingURL=782.e22694f3.js.map