"use strict";(self["webpackChunksdpo_frontend"]=self["webpackChunksdpo_frontend"]||[]).push([[626,481],{2419:function(e,t,i){i.d(t,{NO:function(){return d},QL:function(){return c},TQ:function(){return o},af:function(){return r},o:function(){return u}});var n=i(1857),s=i(8791),a=i(7625);async function r(){return await axios.post("device/photo").then((({data:e})=>e)).catch(n.i)}async function o(){return await axios.get("device/video/size").then((({data:e})=>e)).catch(n.i)}async function d(e){return await axios.post("device/media",{driver_id:e}).then((({data:e})=>e)).catch(n.i)}async function c(){return await axios.post("device/media/stop").then((async({data:e})=>(a.Z.state.temp.photo=a.Z.state.inspection.photo,a.Z.state.temp.video=a.Z.state.inspection.video,await(0,s.SX)(),e))).catch(n.i)}async function u(){return await axios.post("device/video/test").then((({data:e})=>e)).catch(n.i)}},8791:function(e,t,i){i.d(t,{Eq:function(){return a},SX:function(){return r}});var n=i.p+"media/alert.1cca9e8e.ogg",s=i(7625);function a(){new Audio(n).play()}async function r(){await o();let e=5;s.Z.state.waitRecordMedia=!0,s.Z.state.timerRecordMedia=setInterval((()=>{e--,console.log("осталось "+e),e<1&&o()}),1e3)}async function o(){s.Z.state.waitRecordMedia&&(s.Z.state.waitRecordMedia=!1,await clearInterval(s.Z.state.timerRecordMedia))}},2543:function(e,t,i){i.d(t,{Z:function(){return h}});var n=i(3396),s=i(9242);const a={class:"number-form"},r=(0,n._)("div",{class:"number-form__title animate__animated animate__fadeInDown d-2"}," Введите личный номер телефона ",-1),o={class:"number-form__input"};function d(e,t,i,d,c,u){const m=(0,n.up)("input-number");return(0,n.wg)(),(0,n.iD)("div",a,[r,(0,n._)("div",o,[(0,n.wy)((0,n._)("input",{type:"text",class:"animate__animated animate__fadeIn d-5",style:{"letter-spacing":"4px"},"onUpdate:modelValue":t[0]||(t[0]=e=>c.maskNumber=e)},null,512),[[s.nr,c.maskNumber]])]),(0,n.Wm)(m,{onPushIntoNumber:t[1]||(t[1]=e=>u.pushIntoNumber(e)),onPopIntoNumber:t[2]||(t[2]=()=>u.popIntoNumber()),onClearNumber:t[3]||(t[3]=()=>u.clearNumber())})])}var c=i(7557),u={name:"InputPhoneNumber",components:{InputNumber:c.Z},props:{maskInput:{type:String,default:()=>"+7 ... ... .. .."},placeholder:{type:String,default:()=>"."}},data(){return{originNumber:"",maskNumber:"",mask:this.maskInput}},methods:{pushIntoNumber(e){this.isMaxLengthReached()||0===this.originNumber.length&&"8"===e||(this.originNumber+=e)},popIntoNumber(){this.originNumber=this.originNumber.slice(0,-1)},clearNumber(){this.originNumber=""},countOccurrences(){let e=0;for(let t=0;t<this.mask.length;t++)this.mask.charAt(t)===this.placeholder&&e++;return e},isMaxLengthReached(){return this.originNumber.length===this.countOccurrences()},replaceAt(e,t,i){return e.substr(0,t)+i+e.substr(t+i.length)},setMaskNumber(){let e=this.originNumber,t=this.mask;Array.from(e).forEach((e=>{t=this.replaceAt(t,t.indexOf("."),e)})),this.maskNumber=t.split(".").join(""),this.$emit("acceptOn",this.maskNumber.split(" ").join(""))}},watch:{originNumber:function(){this.setMaskNumber()}},mounted(){this.setMaskNumber()}},m=i(89);const l=(0,m.Z)(u,[["render",d]]);var h=l},5511:function(e,t,i){i.d(t,{Z:function(){return u}});var n=i(3396);const s={key:0,class:"admin__loading animate__animated animate__fadeInUp",style:{"z-index":"3"}},a=(0,n._)("div",{class:"lds-ring"},[(0,n._)("div"),(0,n._)("div"),(0,n._)("div"),(0,n._)("div")],-1);function r(e,t,i,r,o,d){return i.loading?((0,n.wg)(),(0,n.iD)("div",s,[a,(0,n.Uk)(" Загрузка ")])):(0,n.kq)("",!0)}var o={props:{loading:{type:Boolean,default:!1}}},d=i(89);const c=(0,d.Z)(o,[["render",r]]);var u=c},3651:function(e,t,i){i.r(t),i.d(t,{default:function(){return Y}});var n=i(3396),s=i(7139),a=i(9242);const r={class:"home"},o={key:0,style:{width:"100%","justify-content":"center",display:"flex"}},d=(0,n._)("div",{class:"driver-form__not-found animate__animated animate__fadeInUp"}," Работа терминала приостановлена. Проверьте подключение к интернету ",-1),c=[d],u={key:1,style:{width:"100%","justify-content":"center",display:"flex"}},m=(0,n._)("div",{class:"driver-form__not-found animate__animated animate__fadeInUp"}," Работа терминала заблокирована. Обратитесь к администратору. ",-1),l=[m],h={key:2,class:"driver-form"},_={key:0,class:"driver-form__title animate__animated animate__fadeInDown d-2"},p={key:1,class:"driver-form__title animate__animated animate__fadeInDown d-2"},v={class:"driver-form__input"},f={key:3,class:"driver-form__not-found animate__animated animate__fadeInUp"};function g(e,t,i,d,m,g){const w=(0,n.up)("medic-select"),b=(0,n.up)("input-personal-number-form");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(w),(0,n._)("div",r,[g.terminalIsLocked?((0,n.wg)(),(0,n.iD)("div",o,c)):g.terminalIsBlocked?((0,n.wg)(),(0,n.iD)("div",u,l)):((0,n.wg)(),(0,n.iD)("div",h,[g.inspection.driver_fio?((0,n.wg)(),(0,n.iD)("div",_,(0,s.zw)(g.inspection.driver_fio),1)):((0,n.wg)(),(0,n.iD)("div",p," Введите ваш идентификатор ")),(0,n._)("div",v,[(0,n.wy)((0,n._)("input",{type:"number",class:"animate__animated animate__fadeIn d-5","onUpdate:modelValue":t[0]||(t[0]=e=>m.driver_id=e),onInput:t[1]||(t[1]=(...e)=>g.checkDriver&&g.checkDriver(...e))},null,544),[[a.nr,m.driver_id]])]),(0,n.Wm)(b,{onPassword:t[2]||(t[2]=e=>g.updateDriverId(e))}),g.hasDriver?((0,n.wg)(),(0,n.iD)("button",{key:2,onClick:t[3]||(t[3]=(...e)=>g.start&&g.start(...e)),class:"btn animate__animated animate__fadeInUp"}," начать осмотр ")):m.error?((0,n.wg)(),(0,n.iD)("div",f,(0,s.zw)(m.error),1)):(0,n.kq)("",!0)]))])],64)}i(7658);var w=i(2227),b=i(4677);const y={key:1,class:"medics animate__animated animate__fadeInRight"},k={key:0,class:"medics__form"},N=(0,n._)("div",{class:"login-form__title"}," Введите пароль ",-1),D={class:"login-form__input"},I={class:"medics__form-selected"},$={key:1,class:"medics__select"},P={key:0,class:"medics__town"},Z={class:"medics__point"},x=["onClick"];function M(e,t,i,r,o,d){const c=(0,n.up)("input-personal-number-form");return(0,n.wg)(),(0,n.iD)(n.HY,null,[d.visible?((0,n.wg)(),(0,n.iD)("div",{key:0,onClick:t[0]||(t[0]=t=>e.$store.state.selectingMedic=!1),class:"medics__overlay animate__animated animate__fadeIn"})):(0,n.kq)("",!0),d.visible?((0,n.wg)(),(0,n.iD)("div",y,["login"===o.status?((0,n.wg)(),(0,n.iD)("div",k,[N,(0,n._)("div",D,[(0,n.wy)((0,n._)("input",{type:"password","onUpdate:modelValue":t[1]||(t[1]=e=>o.password=e)},null,512),[[a.nr,o.password]])]),(0,n.Wm)(c,{onPassword:t[2]||(t[2]=e=>d.updatePassword(e))}),(0,n._)("div",I,(0,s.zw)(d.medic.name||"Сотрудник не выбран"),1)])):((0,n.wg)(),(0,n.iD)("div",$,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.towns,((e,t)=>((0,n.wg)(),(0,n.iD)("div",{key:t},[e?((0,n.wg)(),(0,n.iD)("div",P,(0,s.zw)(e),1)):(0,n.kq)("",!0),e?((0,n.wg)(!0),(0,n.iD)(n.HY,{key:1},(0,n.Ko)(o.medics[e],((e,t)=>((0,n.wg)(),(0,n.iD)("div",{key:t},[(0,n._)("div",Z,(0,s.zw)(t),1),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e,(e=>((0,n.wg)(),(0,n.iD)("button",{key:e.id,class:"medics__item",onClick:t=>d.select(e)},(0,s.zw)(e.name),9,x)))),128))])))),128)):(0,n.kq)("",!0)])))),128))]))])):(0,n.kq)("",!0)],64)}var U=i(9775),q={components:{InputPersonalNumberForm:U.Z},data(){return{medics:{},towns:[],status:"login",password:""}},async mounted(){this.medics=await(0,w.oP)(),this.towns=Object.keys(this.medics).sort()},methods:{updatePassword(e){this.password=e},login(){this.password===this.config?.medic_password&&(this.password="",this.status="select")},async select(e){this.$store.state.config.main.selected_medic={name:e.name,id:e.id,eds:e.eds,validity_eds_start:e.validity_eds_start??null,validity_eds_end:e.validity_eds_end??null},this.status="login",await(0,w.sl)(this.medic)}},computed:{medic(){return this.$store.state.config?.main?.selected_medic||{}},config(){return this.$store.state.config?.main},visible(){return this.$store.state.selectingMedic}},watch:{password:function(e){this.login()}}},C=i(89);const L=(0,C.Z)(q,[["render",M]]);var R=L,S=i(2543),z=i(6481),A=i(7625),O=(i(4457),i(2419)),H={name:"Home",components:{InputAndSavePhone:z["default"],InputPhoneNumber:S.Z,MedicSelect:R,InputPersonalNumberForm:U.Z},data(){return{driver_id:"",error:"",toast:(0,b.pm)(),loading:!1}},methods:{async start(){const e=await(0,w.L$)(this.driver_id);if(!e)return this.driver_id="",void this.toast.error("Водитель с указаным ID не найден");this.$store.state.videoRecording=!0;const t=await(0,O.NO)(e.hash_id);this.$store.state.inspection.photo=t?.photo,this.$store.state.inspection.video=t?.video,console.log("start media"),this.$store.state.inspection.driver_id=e.hash_id,this.$store.state.inspection.driver_fio=e.fio,this.needSetNumberPhone?this.$router.push("/number-phone/add/"):this.$router.push({name:"step-driver"})},updateDriverId(e){this.driver_id=e},async checkDriver(){if(this.$store.state.inspection={},this.error=null,!(this.driver_id.length<6)){this.loading=!0;try{const e=await(0,w.L$)(this.driver_id);e?(this.$store.state.inspection.driver_id=e.hash_id,this.$store.state.inspection.driver_fio=e.fio,this.$store.state.driver=e,this.error=null):(this.$store.state.inspection={},this.error="Водитель не найден")}catch(e){console.log(e.response?.data?.message),this.error=e.response?.data?.message||"Неизвестная ошибка",this.$store.state.inspection={}}this.loading=!1}}},watch:{driver_id:function(e){this.checkDriver()}},computed:{terminalIsLocked(){if(!A.Z.state.connection){if(this.system.max_inspection_in_offline_mod-this.$store.state.config?.dynamic?.count_inspections<=0)return!0;let e=this.$store.state.config?.dynamic?.last_online||new Date;return(new Date-Date.parse(e))/864e5>this.system.delay_day_in_offline_mod}return!1},terminalIsBlocked(){return this.$store.state.config.main?.terminal_is_blocked},system(){return this.$store.state.config?.system||{}},config(){return this.$store.state.config},inspection(){return this.$store.state.inspection},hasDriver(){return this.inspection.driver_id&&!this.error},hasPhoneNumber(){return this.$store.state.driver.phone&&!this.error},needSetNumberPhone(){return this.hasDriver&&!this.hasPhoneNumber&&void 0!==A.Z.state.connection}},async mounted(){await(0,O.QL)()}};const W=(0,C.Z)(H,[["render",g]]);var Y=W},6481:function(e,t,i){i.r(t),i.d(t,{default:function(){return h}});var n=i(3396);const s={key:0,class:"input-save-phone"};function a(e,t,i,a,r,o){const d=(0,n.up)("loader"),c=(0,n.up)("input-phone-number");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(d,{loading:r.loading,"onUpdate:loading":t[0]||(t[0]=e=>r.loading=e)},null,8,["loading"]),this.loading?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",s,[(0,n.Wm)(c,{onAcceptOn:t[1]||(t[1]=e=>o.setPhoneNumber(e))}),o.hasPhone?((0,n.wg)(),(0,n.iD)("button",{key:0,onClick:t[2]||(t[2]=e=>o.storePhone()),class:"btn animate__animated animate__fadeInUp"}," Сохранить ")):(0,n.kq)("",!0)]))],64)}i(7658);var r=i(2543),o=i(5511),d=i(2227),c=i(4677),u={name:"InputAndSavePhone",components:{Loader:o.Z,InputPhoneNumber:r.Z},data(){return{phoneNumber:"",toast:(0,c.pm)(),loading:!1}},methods:{setPhoneNumber(e){this.phoneNumber=e},formattingPhoneNumber(){return"+"===this.phoneNumber[0]?this.phoneNumber.slice(1):this.phoneNumber},async storePhone(){this.loading=!0,await(0,d.Ch)(this.formattingPhoneNumber(),this.$store.state.inspection.driver_id),this.loading=!1,this.$router.push({name:"step-driver"})}},computed:{hasPhone(){return 12===this.phoneNumber.length}}},m=i(89);const l=(0,m.Z)(u,[["render",a]]);var h=l}}]);
//# sourceMappingURL=626.4eb1b4f9.js.map