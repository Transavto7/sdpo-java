"use strict";(self["webpackChunksdpo_frontend"]=self["webpackChunksdpo_frontend"]||[]).push([[129],{1129:function(n,e,t){t.r(e),t.d(e,{default:function(){return v}});var i=t(3396),a=t(7139);const o={class:"step-photo__outer"},s=(0,i._)("h3",{class:"animate__animated animate__fadeInDown"},"Сделайте снимок",-1),r={key:0,class:"admin__loading animate__animated animate__fadeInUp"},c=(0,i._)("div",{class:"lds-ring"},[(0,i._)("div"),(0,i._)("div"),(0,i._)("div"),(0,i._)("div")],-1),d={ref:"video"},l={key:1,class:"step-photo__btns"};function _(n,e,t,_,h,m){return(0,i.wg)(),(0,i.iD)("div",o,[s,h.loading?((0,i.wg)(),(0,i.iD)("div",r,[c,(0,i.Uk)(" Загрузка ")])):(0,i.kq)("",!0),(0,i._)("div",{class:(0,a.C_)(["step-photo__video animate__animated animate__fadeInDown",{preview:!h.translation}])},[(0,i._)("img",d,null,512)],2),h.loading?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",l,[h.translation?((0,i.wg)(),(0,i.iD)("button",{key:0,onClick:e[0]||(e[0]=n=>h.translation=!1),class:"btn animate__animated animate__fadeInDown"},"Фотография")):(0,i.kq)("",!0),h.translation?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("button",{key:1,onClick:e[1]||(e[1]=n=>m.next()),class:"btn blue animate__animated animate__fadeInDown"},"Сохранить")),h.translation?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("button",{key:2,onClick:e[2]||(e[2]=n=>h.translation=!0),class:"btn animate__animated animate__fadeInDown"},"Отмена"))]))])}t(7658);var h=t(2227),m={data(){return{connection:null,image:null,translation:!0,loading:!0}},mounted(){this.driver.photo||"employee"===this.inspection.type?this.$router.push({name:"step-ride"}):this.connect()},unmounted(){this.disconnect()},computed:{inspection(){return this.$store.state.inspection},driver(){return this.$store.state.driver??this.$store.state.employee??{}}},methods:{next(){const n=new FileReader;n.readAsDataURL(this.image),n.onloadend=()=>{(0,h.S1)(this.driver?.hash_id,n.result.split(",")[1])},this.$router.push({name:"step-ride"})},connect(){this.connection=new WebSocket("ws://localhost:8080/video"),this.connection.onmessage=n=>{if(this.translation){this.loading=!1;const e=n.data,t=URL.createObjectURL(e);this.$refs.video.src=t,this.image=e}},this.connection.onopen=n=>{console.log("Successfully connected to the echo websocket server...")},this.connection.error=n=>{console.log(n)}},async disconnect(){console.log("Disconnect websoket server"),await(0,h.rd)()}}},u=t(89);const p=(0,u.Z)(m,[["render",_]]);var v=p}}]);
//# sourceMappingURL=129.68368b94.js.map