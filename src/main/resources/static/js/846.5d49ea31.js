"use strict";(self["webpackChunksdpo_frontend"]=self["webpackChunksdpo_frontend"]||[]).push([[846],{2419:function(e,t,i){i.d(t,{NO:function(){return d},QL:function(){return c},TQ:function(){return o},af:function(){return r},o:function(){return l}});var a=i(1857),n=i(8791),s=i(7625);async function r(){return await axios.post("device/photo").then((({data:e})=>e)).catch(a.i)}async function o(){return await axios.get("device/video/size").then((({data:e})=>e)).catch(a.i)}async function d(e){return await axios.post("device/media",{driver_id:e}).then((({data:e})=>e)).catch(a.i)}async function c(){return await axios.post("device/media/stop").then((async({data:e})=>(s.Z.state.temp.photo=s.Z.state.inspection.photo,s.Z.state.temp.video=s.Z.state.inspection.video,await(0,n.SX)(),e))).catch(a.i)}async function l(){return await axios.post("device/video/test").then((({data:e})=>e)).catch(a.i)}},8791:function(e,t,i){i.d(t,{Eq:function(){return s},SX:function(){return r}});var a=i.p+"media/alert.1cca9e8e.ogg",n=i(7625);function s(){new Audio(a).play()}async function r(){await o();let e=5;n.Z.state.waitRecordMedia=!0,n.Z.state.timerRecordMedia=setInterval((()=>{e--,console.log("осталось "+e),e<1&&o()}),1e3)}async function o(){n.Z.state.waitRecordMedia&&(n.Z.state.waitRecordMedia=!1,await clearInterval(n.Z.state.timerRecordMedia))}},5511:function(e,t,i){i.d(t,{Z:function(){return l}});var a=i(3396);const n={key:0,class:"admin__loading animate__animated animate__fadeInUp",style:{"z-index":"3"}},s=(0,a._)("div",{class:"lds-ring"},[(0,a._)("div"),(0,a._)("div"),(0,a._)("div"),(0,a._)("div")],-1);function r(e,t,i,r,o,d){return i.loading?((0,a.wg)(),(0,a.iD)("div",n,[s,(0,a.Uk)(" Загрузка ")])):(0,a.kq)("",!0)}var o={props:{loading:{type:Boolean,default:!1}}},d=i(89);const c=(0,d.Z)(o,[["render",r]]);var l=c},2531:function(e,t,i){i.r(t),i.d(t,{default:function(){return re}});i(7658);var a=i(3396),n=i(7139),s=i(9242),r=i.p+"img/madam-t7-say.6033cebf.svg",o=i.p+"img/madam-t7.ac16778d.svg";const d=e=>((0,a.dD)("data-v-677027ce"),e=e(),(0,a.Cn)(),e),c={style:{display:"flex"}},l={key:0,class:"step-result"},_={style:{"text-align":"center"}},u={key:0,class:"step-result__header_with_result animate__animated animate__fadeInDown"},p={class:"step-result__text animate__animated animate__fadeInUp"},m=d((()=>(0,a._)("br",null,null,-1))),h={key:1,class:"step-result__header_with_result animate__animated animate__fadeInDown"},y=d((()=>(0,a._)("span",{class:"step-result__text animate__animated animate__fadeInUp"},[(0,a.Uk)(" Подписание осмотра"),(0,a._)("br")],-1))),f=[y],v={class:"step-result__cards"},w={key:0,class:"step-result__card animate__animated animate__fadeInUp d-1"},g=d((()=>(0,a._)("span",null,"Давление",-1))),k={key:1,class:"step-result__card animate__animated animate__fadeInUp d-2"},b=d((()=>(0,a._)("span",null,"Пульс",-1))),U={key:2,class:"step-result__card animate__animated animate__fadeInUp d-2"},P=d((()=>(0,a._)("span",null,"Количество промилле",-1))),I={key:3,class:"step-result__card animate__animated animate__fadeInUp d-2"},R=d((()=>(0,a._)("span",null,"Температура тела",-1))),C={key:4,class:"step-result__card animate__animated animate__fadeInUp d-2"},q=d((()=>(0,a._)("span",null,"Сонливость",-1))),D={key:5,class:"step-result__card animate__animated animate__fadeInUp d-2"},M=d((()=>(0,a._)("span",null,"Самочувствие",-1))),S={class:"step-result__footer"},Z={key:0,class:"step-result__buttons"},$={key:1,class:"step-result__verify"},x={class:"driver-form__input"},O={key:2},T={key:1,class:"madam-t7 animate__fadeInUpBig"},z={class:"madam-t7-text-box animate__animated animate__fadeInUp"},Q={class:"wish"},V={class:"animate__fadeInUp"},A=d((()=>(0,a._)("img",{width:"300",src:r},null,-1))),H=d((()=>(0,a._)("img",{width:"300",height:"500",src:o},null,-1)));function W(e,t,i,r,o,d){const y=(0,a.up)("loader"),W=(0,a.up)("result-repeat"),B=(0,a.up)("input-personal-number-form");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(y,{loading:o.loading,"onUpdate:loading":t[0]||(t[0]=e=>o.loading=e)},null,8,["loading"]),(0,a.Wm)(W,{visible:d.showRetryModal,"onUpdate:visible":t[1]||(t[1]=e=>d.showRetryModal=e),"message-content":d.getComment,"onUpdate:messageContent":t[2]||(t[2]=e=>d.getComment=e),onAccept:t[3]||(t[3]=e=>d.redirectRepeat())},null,8,["visible","message-content"]),(0,a._)("div",c,[o.loading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",_,[o.verified?((0,a.wg)(),(0,a.iD)("h3",u,[(0,a.Uk)("Результаты осмотра: "),(0,a._)("span",p,[(0,a.Uk)((0,n.zw)(o.result.admitted||"ожидание ответа"),1),m])])):(0,a.kq)("",!0),o.verified?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("h3",h,f)),(0,a._)("div",v,[d.inspection.hasOwnProperty("tonometer")?((0,a.wg)(),(0,a.iD)("div",w,[g,(0,a.Uk)(" "+(0,n.zw)(d.inspection.hasOwnProperty("tonometer")?d.inspection.tonometer:"Неизвестно"),1)])):(0,a.kq)("",!0),d.inspection.hasOwnProperty("pulse")?((0,a.wg)(),(0,a.iD)("div",k,[b,(0,a.Uk)(" "+(0,n.zw)(d.inspection.hasOwnProperty("pulse")?d.inspection.pulse:"Неизвестно"),1)])):(0,a.kq)("",!0),d.inspection.hasOwnProperty("alcometer_result")?((0,a.wg)(),(0,a.iD)("div",U,[P,(0,a.Uk)(" "+(0,n.zw)(d.inspection.hasOwnProperty("alcometer_result")?d.inspection.alcometer_result+" ‰":"Неизвестно"),1)])):(0,a.kq)("",!0),d.inspection.hasOwnProperty("t_people")?((0,a.wg)(),(0,a.iD)("div",I,[R,(0,a.Uk)(" "+(0,n.zw)(d.inspection.hasOwnProperty("t_people")?d.inspection.t_people+" °C":"Неизвестно"),1)])):(0,a.kq)("",!0),d.inspection.hasOwnProperty("sleep_status")?((0,a.wg)(),(0,a.iD)("div",C,[q,(0,a.Uk)(" "+(0,n.zw)(d.inspection.hasOwnProperty("sleep_status")?d.getSleepStatus(d.inspection.sleep_status):"Неизвестно"),1)])):(0,a.kq)("",!0),d.inspection.hasOwnProperty("people_status")?((0,a.wg)(),(0,a.iD)("div",D,[M,(0,a.Uk)(" "+(0,n.zw)(d.inspection.hasOwnProperty("people_status")?d.getPeopleStatus(d.inspection.people_status):"Неизвестно"),1)])):(0,a.kq)("",!0)])]),(0,a._)("div",S,[o.verified?((0,a.wg)(),(0,a.iD)("div",Z,[(0,a._)("button",{onClick:t[4]||(t[4]=t=>e.$router.push("/")),class:"btn blue animate__animated animate__fadeInUp"},"В начало"),this.admitted&&this.canRetryPrint?((0,a.wg)(),(0,a.iD)("button",{key:0,onClick:t[5]||(t[5]=e=>d.replayPrint()),class:"btn opacity animate__animated animate__fadeInUp"},"Повтор печати ")):(0,a.kq)("",!0),d.connection&&this.admitted&&this.canRetryPrintQR?((0,a.wg)(),(0,a.iD)("button",{key:1,onClick:t[6]||(t[6]=e=>d.replayPrintQr()),class:"btn opacity animate__animated animate__fadeInUp"},"Повтор печати QR ")):(0,a.kq)("",!0)])):(0,a.kq)("",!0),o.verifyPending&&!o.verified?((0,a.wg)(),(0,a.iD)("div",$,[(0,a._)("div",x,[(0,a.wy)((0,a._)("input",{type:"number",class:"animate__animated animate__fadeIn d-5","onUpdate:modelValue":t[7]||(t[7]=e=>o.verifyCode=e)},null,512),[[s.nr,o.verifyCode]])]),(0,a.Wm)(B,{style:{"margin-bottom":"10px"},onPassword:t[8]||(t[8]=e=>d.updateVerifyCode(e))}),(0,a.Uk)(" SMS для подтверждения отправлено на номер "+(0,n.zw)(d.driverPhone),1)])):(0,a.kq)("",!0),o.verifyPending?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",O,[(0,a._)("button",{onClick:t[9]||(t[9]=(...e)=>d.sendVerify&&d.sendVerify(...e)),class:"btn opacity animate__animated animate__fadeInUp"}," Согласен с результатами измерений. Отправить SMS для подтверждения ")]))])])),o.loading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",T,[(0,a._)("div",z,[(0,a._)("div",Q,[(0,a._)("span",V,(0,n.zw)(d.drawReaction),1)]),A]),H]))])],64)}var B=i(2227);const L={key:1,class:"approval animate__animated animate__fadeInRight"},E=(0,a._)("div",{class:"not-identify__title"},[(0,a._)("h3",null,"Не идентифицирован")],-1),G={class:"approval__content"},N={class:"not-identify__content"};function X(e,t,i,s,r,o){return(0,a.wg)(),(0,a.iD)(a.HY,null,[i.visible?((0,a.wg)(),(0,a.iD)("div",{key:0,onClick:t[0]||(t[0]=(...e)=>o.closeModal&&o.closeModal(...e)),class:"medics__overlay animate__animated animate__fadeIn"})):(0,a.kq)("",!0),i.visible?((0,a.wg)(),(0,a.iD)("div",L,[E,(0,a._)("div",G,[(0,a._)("div",N,(0,n.zw)(this.messageContent),1),(0,a._)("button",{onClick:t[1]||(t[1]=(...e)=>o.accept&&o.accept(...e)),class:"btn approval__button-submit animate__animated animate__fadeInUp"},"В начало осмотра ")])])):(0,a.kq)("",!0)],64)}var Y=i(8791),F={props:{visible:{type:Boolean,require:!0},messageContent:{type:String,require:!0,default:""}},methods:{closeModal(){this.$emit("close-modal")},accept(){this.closeModal(),this.$emit("accept")}},watch:{visible:function(e){e&&(0,Y.Eq)()}}},J=i(89);const j=(0,J.Z)(F,[["render",X]]);var K=j,ee=i(5511),te=i(4457),ie=i(9775),ae=i(2419),ne={components:{InputPersonalNumberForm:ie.Z,Loader:ee.Z,ResultRepeat:K},data(){return{backTimeout:null,verified:!1,verifyCode:"",verifyPending:!1,verification:{},result:{},conclusion:{admitted:"",comments:""},notIdentified:"Не идентифицирован",loading:!1,feedback:null,phrase:""}},async mounted(){this.$data.loading=!0;let e=this,t=async function(){e.$store.state.waitRecordMedia?setTimeout(t,1e3):(e.loading=!1,await e.save(),e.autoStart&&(e.backTimeout=e.setTimeoutAndRedirect()))};setTimeout(t,1e3)},unmounted(){clearTimeout(this.backTimeout)},methods:{getSleepStatus(e){return"Да"===e?"Выспались":"Не выспались"},getPeopleStatus(e){return"Да"===e?"Хорошее":"Плохое"},async getWishMessage(){this.phrase=(await(0,B.MR)()).wish_message??null},async save(){this.result=await(0,B._u)(),console.log(this.result),this.conclusion.admitted=this.result.admitted??"",this.conclusion.comments=this.result.comments??""},async replayPrint(){await(0,B.Jw)()},async replayPrintQr(){await(0,B.Cg)()},redirectHome(){"step-result"===this.$route.name&&this.$router.push("/")},redirectRepeat(){"step-result"===this.$route.name&&this.$router.push({name:"step-retry"})},setTimeoutAndRedirect(){return this.result.admitted===this.notIdentified?setTimeout(this.redirectRepeat,this.system.delay_before_retry_inspection):this.verified?setTimeout(this.redirectHome,this.system.delay_before_redirect_to_main_page):setTimeout(this.setTimeoutAndRedirect,5e3)},updateVerifyCode(e){this.verifyCode=e,this.checkVerificationCode()},async sendVerify(){this.verifyPending=!0,this.verification=await(0,B.g2)(this.inspection.driver_id)},async checkVerificationCode(){5===this.verifyCode.length&&(this.verified=await(0,B._e)(this.verification.id,this.verifyCode),this.verified&&(this.$store.state.videoRecording=!1,await(0,ae.QL)(),console.log("stop media")))}},computed:{autoStart(){return this.system.auto_start},admitted(){return"Допущен"===this.result?.admitted},showRetryModal(){return this.result.admitted===this.notIdentified},getComment(){return this.result.comments??""},inspection(){return this.$store.state.inspection},system(){return this.$store.state.config?.system||{}},driverPhone(){return this.$store.state.driver?.phone||"Ошибка номера!"},drawReaction(){return this.phrase||"Хорошего дня!"},canRetryPrint(){return(0,te.Gw)("printer_write")},canRetryPrintQR(){return(0,te.Gw)("print_qr_check")},connection(){return this.$store.state.connection||!1}}};const se=(0,J.Z)(ne,[["render",W],["__scopeId","data-v-677027ce"]]);var re=se}}]);
//# sourceMappingURL=846.5d49ea31.js.map