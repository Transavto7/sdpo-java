{"version":3,"file":"js/784.f079abc9.js","mappings":"uMAuESA,MAAM,qB,GACPC,EAAAA,EAAAA,GAAsE,MAAlED,MAAM,yCAAwC,mBAAe,G,SAE7CA,MAAM,sD,GACtBC,EAAAA,EAAAA,GAAwE,OAAnED,MAAM,YAAU,EAACC,EAAAA,EAAAA,GAAW,eAAW,eAAW,eAAW,Y,GAK7DC,IAAI,S,SAGRF,MAAM,oB,0CAZfG,EAAAA,EAAAA,IAoBM,MApBNC,EAoBM,CAnBFC,EAEWC,EAAAA,UAAO,WAAlBH,EAAAA,EAAAA,IAGM,MAHNI,EAGM,CAFFC,GAAwE,0BAE5E,eAEYF,EAAAA,SACS,iBADF,WAAnBH,EAAAA,EAAAA,IAEM,O,MAFeH,OAAK,SAAC,0DAAyD,CAAAS,SAAoBH,EAAAA,gB,EACpGL,EAAAA,EAAAA,GAAiB,MAAjBS,EAAiB,eAGgBJ,EAAAA,SAM2B,iBANpB,WAA5CH,EAAAA,EAAAA,IAOM,MAPNQ,EAOM,CANyCL,EAAAA,cAAW,WAAtDH,EAAAA,EAAAA,IACyE,U,MADhES,QAAK,eAAEN,EAAAA,aAAc,GAC1BN,MAAM,6CAA4C,gBAAU,eACjCM,EAAAA,aACqC,iBAD1B,WAA1CH,EAAAA,EAAAA,IAC6E,U,MADpES,QAAK,eAAEC,EAAAA,QACZb,MAAM,kDAAiD,cAChBM,EAAAA,aACiB,iBADN,WAAtDH,EAAAA,EAAAA,IACqE,U,MAD5DS,QAAK,eAAEN,EAAAA,aAAc,GAC1BN,MAAM,6CAA4C,e,uBAtFlE,GACIc,OACI,MAAO,CACHC,WAAY,KACZC,MAAO,KACPC,aAAa,EACbC,SAAS,EAEjB,EACAC,UACQC,KAAKC,OAAOC,MACZF,KAAKG,QAAQC,KAAK,CAAEC,KAAM,cAI9BL,KAAKM,SACT,EACAC,YACGP,KAAKQ,YACR,EACAC,SAAU,CACNC,aACI,OAAOV,KAAKW,OAAOC,MAAMF,UAC7B,EACAT,SACI,OAAOD,KAAKW,OAAOC,MAAMX,QAAU,CAAC,CACxC,GAEJY,QAAS,CACLC,OACI,MAAMC,EAAS,IAAIC,WACnBD,EAAOE,cAAcjB,KAAKJ,OAC1BmB,EAAOG,UAAY,MACfC,EAAAA,EAAAA,IAAenB,KAAKC,QAAQmB,QAASL,EAAOM,OAAOC,MAAM,KAAK,GAAG,EAGrEtB,KAAKG,QAAQC,KAAK,CAAEC,KAAM,aAC9B,EACAC,UACIN,KAAKL,WAAa,IAAI4B,UAAU,6BAEhCvB,KAAKL,WAAW6B,UAAaC,IACzB,GAAIzB,KAAKH,YAAa,CAClBG,KAAKF,SAAU,EACf,MAAMJ,EAAO+B,EAAM/B,KACbgC,EAAMC,IAAIC,gBAAgBlC,GAChCM,KAAK6B,MAAMC,MAAMC,IAAML,EACvB1B,KAAKJ,MAAQF,CACjB,GAGJM,KAAKL,WAAWqC,OAAUP,IACtBQ,QAAQC,IAAI,yDAAyD,EAGzElC,KAAKL,WAAWwC,MAASA,IACrBF,QAAQC,IAAIC,EAAM,CAE1B,EACAC,mBACIH,QAAQC,IAAI,oCACNG,EAAAA,EAAAA,KACV,I,QC5DR,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,KAEpE,O","sources":["webpack://sdpo-frontend/./src/pages/steps/Step-photo.vue","webpack://sdpo-frontend/./src/pages/steps/Step-photo.vue?3576"],"sourcesContent":["<script>\r\nimport { setDriverPhoto, closeDriverPhoto } from '@/helpers/api';\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            connection: null,\r\n            image: null,\r\n            translation: true,\r\n            loading: true,\r\n        }\r\n    },\r\n    mounted() {\r\n        if (this.driver.photo) {\r\n            this.$router.push({ name: 'step-ride' });\r\n            return;\r\n        }\r\n\r\n        this.connect();\r\n    },\r\n    unmounted() {\r\n       this.disconnect();\r\n    },\r\n    computed: {\r\n        inspection() {\r\n            return this.$store.state.inspection;\r\n        },\r\n        driver() {\r\n            return this.$store.state.driver ?? {};\r\n        }\r\n    },\r\n    methods: {\r\n        next() {\r\n            const reader = new FileReader();\r\n            reader.readAsDataURL(this.image); \r\n            reader.onloadend = () => {\r\n                setDriverPhoto(this.driver?.hash_id, reader.result.split(',')[1]);\r\n            }\r\n\r\n            this.$router.push({ name: 'step-ride' })\r\n        },\r\n        connect() {\r\n            this.connection = new WebSocket(\"ws://localhost:8080/video\")\r\n\r\n            this.connection.onmessage = (event) => {\r\n                if (this.translation) {\r\n                    this.loading = false;\r\n                    const data = event.data;\r\n                    const img = URL.createObjectURL(data);\r\n                    this.$refs.video.src = img;\r\n                    this.image = data;\r\n                }\r\n            }\r\n\r\n            this.connection.onopen = (event) => {\r\n                console.log(\"Successfully connected to the echo websocket server...\")\r\n            }\r\n            \r\n            this.connection.error = (error) => {\r\n                console.log(error);\r\n            }\r\n        },\r\n        async disconnect() {\r\n            console.log('Disconnect websoket server');\r\n            await closeDriverPhoto();\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div class=\"step-photo__outer\">\r\n        <h3 class=\"animate__animated animate__fadeInDown\">Сделайте снимок</h3>\r\n\r\n        <div v-if=\"loading\" class=\"admin__loading animate__animated animate__fadeInUp\">\r\n            <div class=\"lds-ring\"><div></div><div></div><div></div><div></div></div> \r\n            Загрузка\r\n        </div>\r\n\r\n        <div v-if=\"!loading\" class=\"step-photo__video animate__animated animate__fadeInDown\" :class=\"{preview: !translation}\">\r\n            <img ref=\"video\">\r\n        </div>\r\n\r\n        <div class=\"step-photo__btns\" v-if=\"!loading\">\r\n            <button @click=\"translation = false\" v-if=\"translation\"\r\n                class=\"btn animate__animated animate__fadeInDown\">Фотография</button> \r\n            <button @click=\"next()\" v-if=\"!translation\"\r\n                class=\"btn blue animate__animated animate__fadeInDown\">Сохранить</button> \r\n            <button @click=\"translation = true\" v-if=\"!translation\"\r\n                class=\"btn animate__animated animate__fadeInDown\">Отмена</button> \r\n        </div>\r\n    </div>\r\n</template>","import { render } from \"./Step-photo.vue?vue&type=template&id=497b702a\"\nimport script from \"./Step-photo.vue?vue&type=script&lang=js\"\nexport * from \"./Step-photo.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\ellidey\\\\IdeaProjects\\\\sdpo\\\\src\\\\main\\\\frontend\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","_createElementVNode","ref","_createElementBlock","_hoisted_1","_hoisted_2","$data","_hoisted_3","_hoisted_4","preview","_hoisted_5","_hoisted_6","onClick","$options","data","connection","image","translation","loading","mounted","this","driver","photo","$router","push","name","connect","unmounted","disconnect","computed","inspection","$store","state","methods","next","reader","FileReader","readAsDataURL","onloadend","setDriverPhoto","hash_id","result","split","WebSocket","onmessage","event","img","URL","createObjectURL","$refs","video","src","onopen","console","log","error","async","closeDriverPhoto","__exports__","render"],"sourceRoot":""}