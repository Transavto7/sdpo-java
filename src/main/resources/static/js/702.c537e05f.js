"use strict";(self["webpackChunksdpo_frontend"]=self["webpackChunksdpo_frontend"]||[]).push([[702],{4575:function(t,e,n){n.d(e,{S:function(){return r},g:function(){return a}});var i=n(4161),s=n(1857);async function r(){return await i.Z.post("device/printer").then((({data:t})=>t)).catch(s.i)}async function a(t,e){return await i.Z.post("/device/printer/test/qr",{driver:t,type:e}).then((({data:t})=>t)).catch(s.i)}},7557:function(t,e,n){n.d(e,{Z:function(){return p}});var i=n(3396);const s={class:"number-buttons",ref:"numbers"},r=(0,i._)("i",{class:"ri-close-fill"},null,-1),a=[r],o=(0,i._)("i",{class:"ri-delete-back-line"},null,-1),d=[o];function c(t,e,n,r,o,c){return(0,i.wg)(),(0,i.iD)("div",s,[(0,i._)("button",{class:"number-buttons__item",onClick:e[0]||(e[0]=t=>c.pushIntoNumber("1"))},"1"),(0,i._)("button",{class:"number-buttons__item",onClick:e[1]||(e[1]=t=>c.pushIntoNumber("2"))},"2"),(0,i._)("button",{class:"number-buttons__item",onClick:e[2]||(e[2]=t=>c.pushIntoNumber("3"))},"3"),(0,i._)("button",{class:"number-buttons__item",onClick:e[3]||(e[3]=t=>c.pushIntoNumber("4"))},"4"),(0,i._)("button",{class:"number-buttons__item",onClick:e[4]||(e[4]=t=>c.pushIntoNumber("5"))},"5"),(0,i._)("button",{class:"number-buttons__item",onClick:e[5]||(e[5]=t=>c.pushIntoNumber("6"))},"6"),(0,i._)("button",{class:"number-buttons__item",onClick:e[6]||(e[6]=t=>c.pushIntoNumber("7"))},"7"),(0,i._)("button",{class:"number-buttons__item",onClick:e[7]||(e[7]=t=>c.pushIntoNumber("8"))},"8"),(0,i._)("button",{class:"number-buttons__item",onClick:e[8]||(e[8]=t=>c.pushIntoNumber("9"))},"9"),(0,i._)("button",{class:"number-buttons__item",onClick:e[9]||(e[9]=t=>c.clearPassword())},a),(0,i._)("button",{class:"number-buttons__item",onClick:e[10]||(e[10]=t=>c.pushIntoNumber("0"))},"0"),(0,i._)("button",{class:"number-buttons__item",onClick:e[11]||(e[11]=t=>c.popIntoNumber())},d)],512)}var l={name:"InputNumber",methods:{pushIntoNumber(t){this.$emit("pushIntoNumber",t)},popIntoNumber(){this.$emit("popIntoNumber")},clearPassword(){this.$emit("clearNumber")}},mounted(){this.$refs.numbers.querySelectorAll("button").forEach(((t,e)=>{t.classList.add("animate__animated"),t.classList.add("animate__fadeInUp"),t.style.setProperty("animation-delay",.6+.05*e+"s")}))}},u=n(89);const m=(0,u.Z)(l,[["render",c]]);var p=m},9775:function(t,e,n){n.d(e,{Z:function(){return c}});var i=n(3396);function s(t,e,n,s,r,a){const o=(0,i.up)("input-number");return(0,i.wg)(),(0,i.j4)(o,{onPushIntoNumber:e[0]||(e[0]=t=>a.pushCharIntoPassword(t)),onPopIntoNumber:e[1]||(e[1]=()=>a.extractLastCharIntoPassword()),onClearNumber:e[2]||(e[2]=()=>a.clearPassword())})}var r=n(7557),a={name:"InputPersonalNumberForm",components:{InputNumber:r.Z},data(){return{password:""}},methods:{pushCharIntoPassword(t){this.password+=t},extractLastCharIntoPassword(){this.password=this.password.slice(0,-1)},clearPassword(){this.password=""},emitPass(){this.$emit("password",this.password)}},watch:{password:function(){this.emitPass()}}},o=n(89);const d=(0,o.Z)(a,[["render",s]]);var c=d},5511:function(t,e,n){n.d(e,{Z:function(){return l}});var i=n(3396);const s={key:0,class:"admin__loading animate__animated animate__fadeInUp",style:{"z-index":"3"}},r=(0,i._)("div",{class:"lds-ring"},[(0,i._)("div"),(0,i._)("div"),(0,i._)("div"),(0,i._)("div")],-1);function a(t,e,n,a,o,d){return n.loading?((0,i.wg)(),(0,i.iD)("div",s,[r,(0,i.Uk)(" Загрузка ")])):(0,i.kq)("",!0)}var o={props:{loading:{type:Boolean,default:!1}}},d=n(89);const c=(0,d.Z)(o,[["render",a]]);var l=c},9894:function(t,e,n){n.r(e),n.d(e,{default:function(){return at}});var i=n(3396);function s(t,e,n,s,r,a){const o=(0,i.up)("print-login"),d=(0,i.up)("print-selection"),c=(0,i.up)("print-index"),l=(0,i.up)("loader");return(0,i.wg)(),(0,i.iD)(i.HY,null,[this.login||this.loading?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(o,{key:0,onSuccessAuth:e[0]||(e[0]=t=>a.setDriver(t))})),!this.login||this.loading||this.stepInspection?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(d,{key:1,onSelect:e[1]||(e[1]=t=>a.selectTab(t))})),this.login&&!this.loading&&this.stepInspection?((0,i.wg)(),(0,i.j4)(c,{key:2,onPrint:e[2]||(e[2]=t=>a.printQuery(t)),inspections:r.inspections,"onUpdate:inspections":e[3]||(e[3]=t=>r.inspections=t),driver:r.driver,"onUpdate:driver":e[4]||(e[4]=t=>r.driver=t)},null,8,["inspections","driver"])):(0,i.kq)("",!0),(0,i.Wm)(l,{loading:r.loading,"onUpdate:loading":e[5]||(e[5]=t=>r.loading=t)},null,8,["loading"])],64)}n(7658);var r=n(7139),a=n(9242);const o={class:"home"},d={class:"driver-form"},c={key:0,class:"driver-form__title animate__animated animate__fadeInDown d-2"},l={key:1,class:"driver-form__title animate__animated animate__fadeInDown d-2"},u={class:"driver-form__input"},m={key:2,class:"driver-form__not-found animate__animated animate__fadeInUp"};function p(t,e,n,s,p,_){const h=(0,i.up)("input-personal-number-form");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",d,[p.driver.driver_fio?((0,i.wg)(),(0,i.iD)("div",c,(0,r.zw)(p.driver.driver_fio),1)):((0,i.wg)(),(0,i.iD)("div",l," Введите ваш идентификатор ")),(0,i._)("div",u,[(0,i.wy)((0,i._)("input",{type:"number",class:"animate__animated animate__fadeIn d-5","onUpdate:modelValue":e[0]||(e[0]=t=>p.driver_id=t),onInput:e[1]||(e[1]=(...t)=>_.checkDriver&&_.checkDriver(...t))},null,544),[[a.nr,p.driver_id]])]),(0,i.Wm)(h,{onPassword:e[2]||(e[2]=t=>_.updateDriverId(t))}),p.error?((0,i.wg)(),(0,i.iD)("div",m,(0,r.zw)(p.error),1)):(0,i.kq)("",!0)])])}var _=n(9775),h=n(6509),v=n(4677),b={components:{InputPersonalNumberForm:_.Z},data(){return{driver_id:"",driver:{},error:"",toast:(0,v.pm)(),loading:!1}},methods:{async start(){this.$emit("success-auth",this.driver)},updateDriverId(t){this.driver_id=t},async checkDriver(){if(this.error=null,!(this.driver_id.length<6)){this.loading=!0;try{const t=await(0,h.L$)(this.driver_id);t?(this.driver=t,this.error=null,await this.start()):this.error="Водитель не найден"}catch(t){this.error=t.response?.data?.message||"Неизвестная ошибка"}this.loading=!1}}},watch:{driver_id:function(t){this.checkDriver(),this.hasDriver||(this.processingApproval=!1)}},computed:{config(){return this.$store.state.config},hasDriver(){return this.driver.driver_id&&!this.error}},mounted(){}},g=n(89);const f=(0,g.Z)(b,[["render",p]]);var w=f;const I={class:"last-inspection"},k={class:"last-inspection__header"},y={class:"last-inspection_body"},D={class:"content-block__calendar"},N={key:0,class:"content-block__table"},C=(0,i._)("thead",null,[(0,i._)("tr",null,[(0,i._)("th",{style:{width:"40%"}},"Дата Время"),(0,i._)("th",null,"Тип осмотра"),(0,i._)("th")])],-1),P={class:"animate__animated animate__fadeInUp"},Z={class:"animate__animated animate__fadeInUp"},x={class:"time"},U=["onClick"],$=(0,i._)("i",{class:"ri-printer-fill"},null,-1),q=[$],S={key:1,class:"content-block__warning"},F=(0,i._)("div",{class:"driver-form__not-found animate__animated animate__fadeInUp"},"Осмотры на выбранную дату не проводились ",-1),L=[F];function j(t,e,n,s,a,o){const d=(0,i.up)("VueDatePicker");return(0,i.wg)(),(0,i.iD)("div",I,[(0,i._)("div",k,[(0,i._)("h1",null,(0,r.zw)(n.driver.fio),1)]),(0,i._)("div",y,[(0,i._)("div",D,[(0,i.Wm)(d,{modelValue:a.date,"onUpdate:modelValue":e[0]||(e[0]=t=>a.date=t),inline:"","auto-apply":"","disable-year-select":!0,locale:"ru","hide-navigation":["month","time","hours","seconds"],"min-date":o.firstDayLastMonth,"max-date":o.dateNow,"prevent-min-max-navigation":"",markers:a.dateFiltered},null,8,["modelValue","min-date","max-date","markers"])]),o.hasSelectInspections?((0,i.wg)(),(0,i.iD)("div",N,[(0,i._)("table",null,[C,(0,i._)("tbody",P,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(this.inspectionsFiltered,(t=>((0,i.wg)(),(0,i.iD)("tr",Z,[(0,i._)("td",x,(0,r.zw)(o.getTimeOnly(t.created_at)),1),(0,i._)("td",null,(0,r.zw)(t.type_view),1),(0,i._)("td",null,[(0,i._)("a",{class:"btn icon",onClick:e=>o.print(t)},q,8,U)])])))),256))])])])):(0,i.kq)("",!0),o.hasSelectInspections?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",S,L))])])}var z=n(7190),Q={components:{VueDatePicker:z.Z},props:{inspections:{type:Object,require:!0,default:()=>({})},driver:{type:Object,require:!0}},data(){return{date:new Date,inspectionsFiltered:[],dateFiltered:[]}},methods:{getTimeOnly(t){return new Date(t).toTimeString().split(" ")[0]},print(t){this.$emit("print",t)},initDateRange(){if(this.hasInspections)for(const t of this.inspections)this.dateFiltered.push({date:t.created_at,type:"line",color:"red"})}},watch:{date(){if(this.inspectionsFiltered=[],this.hasInspections)for(const t of this.inspections)new Date(t.created_at).toDateString()===new Date(this.date).toDateString()&&this.inspectionsFiltered.push(t)}},computed:{dateNow(){return new Date},firstDayLastMonth(){let t=new Date;return t.setMonth(t.getMonth()-1,1),t},hasSelectInspections(){return this.inspectionsFiltered.length>0},hasInspections(){return this.inspections.length>0}},mounted(){this.initDateRange(),this.date=this.dateNow},unmounted(){}};const R=(0,g.Z)(Q,[["render",j]]);var V=R,T=n.p+"img/busQR.cc984633.svg",A=n.p+"img/driverQR.1bd9383a.svg",M=n.p+"img/inspection.29fc9c17.svg";const O={class:"print-selection"},B=(0,i._)("img",{width:"300",src:T},null,-1),H=(0,i._)("label",{style:{"margin-top":"15px"}},"QR испекции автомобиля",-1),W=[B,H],Y={class:"tab"},E=(0,i._)("label",{style:{"margin-top":"15px"}},"QR осмотра водителя",-1),K={class:"tab"},G=(0,i._)("label",null,"Заключение медицинского осмотра",-1);function J(t,e,n,s,r,a){return(0,i.wg)(),(0,i.iD)("div",O,[(0,i._)("div",{class:"tab animate__animated animate__fadeInUp d-1",onClick:e[0]||(e[0]=t=>a.selectBus())},W),(0,i._)("div",Y,[(0,i._)("img",{width:"300",src:A,onClick:e[1]||(e[1]=t=>a.selectDriver())}),E]),(0,i._)("div",K,[(0,i._)("img",{style:{"margin-bottom":"15px","margin-top":"15px"},width:"250",src:M,onClick:e[2]||(e[2]=t=>a.selectInspection())}),G])])}var X={methods:{selectBus(){this.$emit("select","carId")},selectDriver(){this.$emit("select","driverId")},selectInspection(){this.$emit("select","inspection")}}};const tt=(0,g.Z)(X,[["render",J]]);var et=tt,nt=n(5511),it=n(4575),st={components:{PrintSelection:et,Loader:nt.Z,PrintIndex:V,PrintLogin:w},data(){return{driver:null,toast:(0,v.pm)(),inspections:{},print:!1,errorAuthentication:!1,loading:!1,tab:"all"}},methods:{async confirmPrint(t){await(0,h.xH)(t),this.toast.success("Задание на печать отправлено"),this.$router.push("/")},printQuery(t){this.confirmPrint(t)},async setDriver(t){this.loading=!0,this.inspections=await(0,h.vs)(t.hash_id),this.driver=t,this.loading=!1},selectTab(t){"inspection"!==t?((0,it.g)(this.driver.hash_id,t),this.toast.success("Задание на печать отправлено")):this.tab="inspection"}},computed:{login(){return null!==this.driver},stepInspection(){return"inspection"===this.tab}}};const rt=(0,g.Z)(st,[["render",s]]);var at=rt}}]);
//# sourceMappingURL=702.c537e05f.js.map