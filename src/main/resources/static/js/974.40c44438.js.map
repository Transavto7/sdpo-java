{"version":3,"file":"js/974.40c44438.js","mappings":"wMAGA,MAAMA,GAAQC,EAAAA,EAAAA,MAEPC,eAAeC,IAClB,aAAaC,MAAMC,KAAM,oBAAmBC,MAAK,EAAGC,UACzCA,IACRC,MAAMC,EACb,CAEOP,eAAeQ,IAClB,aAAaN,MAAMC,KAAM,0BAAyBC,MAAK,EAAGC,UAC/CA,IACRC,MAAMC,EACb,CAEA,SAASA,EAAaE,GAClB,MAAMJ,EAAOI,EAAMC,UAAUL,KAC7B,GAAIA,GAAMM,QACNb,EAAMW,MAAMJ,EAAKM,cACd,GAAIF,EAAMC,SACb,OAAQD,GAAOC,UAAUE,QACrB,KAAK,IAAKd,EAAMW,MAAM,8BACtB,KAAK,IAAKX,EAAMW,MAAM,kBACtB,QAASX,EAAMW,MAAM,mCAGzBI,EAAAA,EAAAA,OAAAA,aAA2B,EAG/BC,QAAQC,IAAIN,EAChB,C,wJC9BcV,EAAAA,EAAAA,MAEPC,eAAegB,IAClB,aAAad,MAAMC,KAAM,gBAAeC,MAAK,EAAGC,UACrCA,IACRC,MAAMC,EACb,CAEOP,eAAeiB,IAClB,aAAaf,MAAMgB,IAAK,qBAAoBd,MAAK,EAAGC,UACzCA,IACRC,MAAMC,EACb,CAEOP,eAAemB,IAClB,aAAajB,MAAMC,KAAM,gBAAeC,MAAK,EAAGC,UACrCA,IACRC,MAAMC,EACb,CAEOP,eAAeoB,IAClB,aAAalB,MAAMC,KAAM,qBAAoBC,MAAK,EAAGC,UAC1CA,IACRC,MAAMC,EACb,CAEA,SAASA,EAAaE,GACdA,EAAMC,WACNG,EAAAA,EAAAA,OAAAA,aAA2B,GAG/BC,QAAQC,IAAIN,EAChB,C,qKCwBSY,MAAM,iB,gxBA0BFA,MAAM,gB,0CA1BfC,EAAAA,EAAAA,IA8BM,MA9BNC,EA8BM,CA7BFC,GAyBAC,EAAAA,EAAAA,GAGM,MAHNC,EAGM,EAFFD,EAAAA,EAAAA,GAAmE,UAA1DE,QAAK,eAAEC,EAAAA,YAAYP,MAAM,oBAAmB,SACnBQ,KAAKC,MAAMF,EAAAA,OAAOG,kBAAc,WAAlET,EAAAA,EAAAA,IAAoG,U,MAA3FK,QAAK,eAAEC,EAAAA,YAAqDP,MAAM,OAAM,gBAAU,kB,iCAlFvG,GACIhB,OACI,MAAO,CACH2B,SAAU,KAElB,EACAC,QAAS,CACNjC,mBACS6B,KAAKC,MAAMI,KAAKC,OAAOC,gBAAkBF,KAAKG,WAAWC,QACzDJ,KAAKG,WAAWC,YAActB,EAAAA,EAAAA,OAE9Ba,KAAKC,MAAMI,KAAKC,OAAOI,gBAAkBL,KAAKG,WAAWG,QACzDN,KAAKG,WAAWG,YAAcrB,EAAAA,EAAAA,MAEtC,EACAnB,iBACIyC,cAAcP,KAAKF,UACnBE,KAAKQ,QAAQC,KAAK,YAClBnC,EAAAA,EAAAA,IACJ,EACAR,iBACIyC,cAAcP,KAAKF,UACnBE,KAAKQ,QAAQC,KAAK,YAClBnC,EAAAA,EAAAA,IACJ,GAEJR,gBACIkC,KAAKU,aAELV,KAAKF,SAAWa,aAAY7C,UACxB,MAAM8C,QAAe7C,EAAAA,EAAAA,KAEN,SAAX6C,IAIJZ,KAAKG,WAAWU,iBAAmBC,OAAOF,IAAW,EACrDZ,KAAKe,WAAU,GAChB,IACP,EACAC,YACIT,cAAcP,KAAKF,SACvB,EACAmB,SAAU,CACNd,aACI,OAAOH,KAAKkB,OAAOC,MAAMhB,UAC7B,EACAF,SACI,OAAOD,KAAKkB,OAAOC,MAAMC,QAAQnB,QAAU,CAAC,CAChD,I,QChDR,MAAMoB,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,KAEpE,O","sources":["webpack://sdpo-frontend/./src/helpers/alcometer.js","webpack://sdpo-frontend/./src/helpers/camera.js","webpack://sdpo-frontend/./src/pages/steps/Step-5.vue","webpack://sdpo-frontend/./src/pages/steps/Step-5.vue?18a3"],"sourcesContent":["import store from \"@/store\";\r\nimport { ErrorCodes } from \"vue\";\r\nimport { useToast } from \"vue-toastification\";\r\nconst toast = useToast();\r\n\r\nexport async function getAlcometerResult() {\r\n    return await axios.post(`device/alcometer`).then(({ data }) => {            \r\n        return data;\r\n    }).catch(defaultError);\r\n}\r\n\r\nexport async function closeAlcometer() {\r\n    return await axios.post(`device/alcometer/close`).then(({ data }) => {            \r\n        return data;\r\n    }).catch(defaultError);\r\n}\r\n\r\nfunction defaultError(error) {\r\n    const data = error.response?.data;\r\n    if (data?.message) {\r\n        toast.error(data.message);\r\n    } else if (error.response) {\r\n        switch (error?.response?.status) {\r\n            case 400: toast.error('Ошибка авторизации запроса')\r\n            case 500: toast.error('Ошибка сервера')\r\n            default: toast.error('Неизвестная ошибка запроса')\r\n        }\r\n    } else {\r\n        store.$state.loseConnect = true;\r\n    }\r\n    \r\n    console.log(error);\r\n}","import store from \"@/store\";\r\nimport { useToast } from \"vue-toastification\";\r\nconst toast = useToast();\r\n\r\nexport async function makePhoto() {\r\n    return await axios.post(`device/photo`).then(({ data }) => {\r\n        return data;\r\n    }).catch(defaultError);\r\n}\r\n\r\nexport async function getSizes() {\r\n    return await axios.get(`device/video/size`).then(({ data }) => {\r\n        return data;\r\n    }).catch(defaultError);\r\n}\r\n\r\nexport async function makeVideo() {\r\n    return await axios.post(`device/video`).then(({ data }) => {\r\n        return data;\r\n    }).catch(defaultError);\r\n}\r\n\r\nexport async function makeVideoTest() {\r\n    return await axios.post(`device/video/test`).then(({ data }) => {\r\n        return data;\r\n    }).catch(defaultError);\r\n}\r\n\r\nfunction defaultError(error) {\r\n    if (error.response) {\r\n        store.$state.loseConnect = true;\r\n    }\r\n    \r\n    console.log(error);\r\n}","<script>\r\nimport { getAlcometerResult, closeAlcometer } from '@/helpers/alcometer';\r\nimport { makePhoto, makeVideo } from '@/helpers/camera';\r\n\r\nexport default {\r\n    data() {\r\n        return {\r\n            interval: null,\r\n        }\r\n    },\r\n    methods: {\r\n       async saveWebCam() {\r\n            if (JSON.parse(this.system.camera_photo) && !this.inspection.photo) {\r\n                this.inspection.photo = await makePhoto();\r\n            }\r\n            if (JSON.parse(this.system.camera_video) && !this.inspection.video) {\r\n                this.inspection.video = await makeVideo();\r\n            }\r\n        },\r\n        async nextStep() {\r\n            clearInterval(this.interval);\r\n            this.$router.push('/step/6');\r\n            closeAlcometer();\r\n        },\r\n        async prevStep() {\r\n            clearInterval(this.interval);\r\n            this.$router.push('/step/4');\r\n            closeAlcometer();\r\n        }\r\n    },\r\n    async mounted() {\r\n        this.saveWebCam();\r\n\r\n        this.interval = setInterval(async () => {\r\n            const result = await getAlcometerResult();\r\n\r\n            if (result === 'next') {\r\n                return;\r\n            }\r\n\r\n            this.inspection.alcometer_result = Number(result) || 0;\r\n            this.nextStep();\r\n        }, 1000);\r\n    },\r\n    unmounted() {\r\n        clearInterval(this.interval);\r\n    },\r\n    computed: {\r\n        inspection() {\r\n            return this.$store.state.inspection;\r\n        },\r\n        system() {\r\n            return this.$store.state.config?.system || {};\r\n        }\r\n    }\r\n}\r\n</script>\r\n<template>\r\n    <div class=\"step-5__outer\">\r\n        <div class=\"step-5\">\r\n            <h3 class=\"animate__animated animate__fadeInDown\">Проверка на алкоголь</h3>\r\n\r\n            <div class=\"step-5__items\">\r\n                <div class=\"step-5__item animate__animated animate__fadeInUp d-1\">\r\n                    <span>1</span>\r\n                    <img style=\"padding-right: 20px\" width=\"100\" src=\"@/assets/images/alco_guide.png\">\r\n                    Проверьте, что вставлена воронка\r\n                </div>\r\n                <div class=\"step-5__item animate__animated animate__fadeInUp d-2\">\r\n                    <span>2</span>\r\n                    <img width=\"100\" src=\"@/assets/images/alco_guide_2.png\">\r\n                    Держите алкотестер на расстоянии 2-3 см от рта\r\n                </div>\r\n                <div class=\"step-5__text  animate__animated animate__fadeInUp d-2\">\r\n                    Дождитесь ГОТОВ на экране алкометра<br><br>\r\n                    Начните дуть с умеренной силой до окончания<br>\r\n                    звукового сигнала.<br><br>\r\n                </div>\r\n            </div>\r\n            <p class=\"alert red\">\r\n                <i class=\"ri-alarm-warning-fill\"></i>\r\n                НЕ ПРИКАСАТЬСЯ К АЛКОТЕСТЕРУ ГУБАМИ\r\n            </p>\r\n        </div>\r\n        <div class=\"step-buttons\">\r\n            <button @click=\"prevStep()\" class=\"btn opacity blue\">Назад</button>\r\n            <button @click=\"nextStep()\" v-if=\"JSON.parse(system.alcometer_skip)\" class=\"btn\">Продолжить</button>\r\n        </div>\r\n    </div>\r\n</template>","import { render } from \"./Step-5.vue?vue&type=template&id=b502328a\"\nimport script from \"./Step-5.vue?vue&type=script&lang=js\"\nexport * from \"./Step-5.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\ellidey\\\\IdeaProjects\\\\sdpo\\\\src\\\\main\\\\frontend\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["toast","useToast","async","getAlcometerResult","axios","post","then","data","catch","defaultError","closeAlcometer","error","response","message","status","store","console","log","makePhoto","getSizes","get","makeVideo","makeVideoTest","class","_createElementBlock","_hoisted_1","_hoisted_2","_createElementVNode","_hoisted_3","onClick","$options","JSON","parse","alcometer_skip","interval","methods","this","system","camera_photo","inspection","photo","camera_video","video","clearInterval","$router","push","saveWebCam","setInterval","result","alcometer_result","Number","nextStep","unmounted","computed","$store","state","config","__exports__","render"],"sourceRoot":""}