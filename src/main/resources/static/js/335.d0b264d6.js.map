{"version":3,"file":"js/335.d0b264d6.js","mappings":"uMAuESA,MAAM,qB,GACPC,EAAAA,EAAAA,GAAsE,MAAlED,MAAM,yCAAwC,mBAAe,G,SAE7CA,MAAM,sD,GACtBC,EAAAA,EAAAA,GAAwE,OAAnED,MAAM,YAAU,EAACC,EAAAA,EAAAA,GAAW,QAAAA,EAAAA,EAAAA,GAAW,QAAAA,EAAAA,EAAAA,GAAW,QAAAA,EAAAA,EAAAA,GAAW,Y,GAK7DC,IAAI,S,SAGRF,MAAM,oB,0CAZfG,EAAAA,EAAAA,IAoBM,MApBNC,EAoBM,CAnBFC,EAEWC,EAAAC,UAAO,WAAlBJ,EAAAA,EAAAA,IAGM,MAHNK,EAGM,CAFFC,GAAwE,0BAE5E,gBAEAR,EAAAA,EAAAA,GAEM,OAFDD,OAAKU,EAAAA,EAAAA,IAAA,CAAC,0DAAyD,CAAAC,SAAoBL,EAAAM,gB,EACpFX,EAAAA,EAAAA,GAAiB,MAAjBY,EAAiB,cAGgBP,EAAAC,SAM2B,iBANpB,WAA5CJ,EAAAA,EAAAA,IAOM,MAPNW,EAOM,CANyCR,EAAAM,cAAW,WAAtDT,EAAAA,EAAAA,IACyE,U,MADhEY,QAAKC,EAAA,KAAAA,EAAA,GAAAC,GAAEX,EAAAM,aAAc,GAC1BZ,MAAM,6CAA4C,gBAAU,eACjCM,EAAAM,aACqC,iBAD1B,WAA1CT,EAAAA,EAAAA,IAC6E,U,MADpEY,QAAKC,EAAA,KAAAA,EAAA,GAAAC,GAAEC,EAAAC,QACZnB,MAAM,kDAAiD,cAChBM,EAAAM,aACiB,iBADN,WAAtDT,EAAAA,EAAAA,IACqE,U,MAD5DY,QAAKC,EAAA,KAAAA,EAAA,GAAAC,GAAEX,EAAAM,aAAc,GAC1BZ,MAAM,6CAA4C,e,uBAtFlE,GACIoB,OACI,MAAO,CACHC,WAAY,KACZC,MAAO,KACPV,aAAa,EACbL,SAAS,EAEjB,EACAgB,UACQC,KAAKC,OAAOC,MACZF,KAAKG,QAAQC,KAAK,CAAEC,KAAM,cAI9BL,KAAKM,SACT,EACAC,YACGP,KAAKQ,YACR,EACAC,SAAU,CACNC,aACI,OAAOV,KAAKW,OAAOC,MAAMF,UAC7B,EACAT,SACI,OAAOD,KAAKW,OAAOC,MAAMX,QAAU,CAAC,CACxC,GAEJY,QAAS,CACLlB,OACI,MAAMmB,EAAS,IAAIC,WACnBD,EAAOE,cAAchB,KAAKF,OAC1BgB,EAAOG,UAAY,MACfC,EAAAA,EAAAA,IAAelB,KAAKC,QAAQkB,QAASL,EAAOM,OAAOC,MAAM,KAAK,GAAG,EAGrErB,KAAKG,QAAQC,KAAK,CAAEC,KAAM,aAC9B,EACAC,UACIN,KAAKH,WAAa,IAAIyB,UAAU,6BAEhCtB,KAAKH,WAAW0B,UAAaC,IACzB,GAAIxB,KAAKZ,YAAa,CAClBY,KAAKjB,SAAU,EACf,MAAMa,EAAO4B,EAAM5B,KACb6B,EAAMC,IAAIC,gBAAgB/B,GAChCI,KAAK4B,MAAMC,MAAMC,IAAML,EACvBzB,KAAKF,MAAQF,CACjB,GAGJI,KAAKH,WAAWkC,OAAUP,IACtBQ,QAAQC,IAAI,yDAAyD,EAGzEjC,KAAKH,WAAWqC,MAASA,IACrBF,QAAQC,IAAIC,EAAM,CAE1B,EACAC,mBACIH,QAAQC,IAAI,oCACNG,EAAAA,EAAAA,KACV,I,QC5DR,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,KAEpE,O","sources":["webpack://sdpo-frontend/./src/pages/inspection/Step-photo.vue","webpack://sdpo-frontend/./src/pages/inspection/Step-photo.vue?04a5"],"sourcesContent":["<script>\nimport { setDriverPhoto, closeDriverPhoto } from '@/helpers/api/api';\n\nexport default {\n    data() {\n        return {\n            connection: null,\n            image: null,\n            translation: true,\n            loading: true,\n        }\n    },\n    mounted() {\n        if (this.driver.photo) {\n            this.$router.push({ name: 'step-ride' });\n            return;\n        }\n\n        this.connect();\n    },\n    unmounted() {\n       this.disconnect();\n    },\n    computed: {\n        inspection() {\n            return this.$store.state.inspection;\n        },\n        driver() {\n            return this.$store.state.driver ?? {};\n        }\n    },\n    methods: {\n        next() {\n            const reader = new FileReader();\n            reader.readAsDataURL(this.image); \n            reader.onloadend = () => {\n                setDriverPhoto(this.driver?.hash_id, reader.result.split(',')[1]);\n            }\n\n            this.$router.push({ name: 'step-ride' })\n        },\n        connect() {\n            this.connection = new WebSocket(\"ws://localhost:8080/video\")\n\n            this.connection.onmessage = (event) => {\n                if (this.translation) {\n                    this.loading = false;\n                    const data = event.data;\n                    const img = URL.createObjectURL(data);\n                    this.$refs.video.src = img;\n                    this.image = data;\n                }\n            }\n\n            this.connection.onopen = (event) => {\n                console.log(\"Successfully connected to the echo websocket server...\")\n            }\n            \n            this.connection.error = (error) => {\n                console.log(error);\n            }\n        },\n        async disconnect() {\n            console.log('Disconnect websoket server');\n            await closeDriverPhoto();\n        }\n    }\n}\n</script>\n\n<template>\n    <div class=\"step-photo__outer\">\n        <h3 class=\"animate__animated animate__fadeInDown\">Сделайте снимок</h3>\n\n        <div v-if=\"loading\" class=\"admin__loading animate__animated animate__fadeInUp\">\n            <div class=\"lds-ring\"><div></div><div></div><div></div><div></div></div> \n            Загрузка\n        </div>\n\n        <div class=\"step-photo__video animate__animated animate__fadeInDown\" :class=\"{preview: !translation}\">\n            <img ref=\"video\">\n        </div>\n\n        <div class=\"step-photo__btns\" v-if=\"!loading\">\n            <button @click=\"translation = false\" v-if=\"translation\"\n                class=\"btn animate__animated animate__fadeInDown\">Фотография</button> \n            <button @click=\"next()\" v-if=\"!translation\"\n                class=\"btn blue animate__animated animate__fadeInDown\">Сохранить</button> \n            <button @click=\"translation = true\" v-if=\"!translation\"\n                class=\"btn animate__animated animate__fadeInDown\">Отмена</button> \n        </div>\n    </div>\n</template>","import { render } from \"./Step-photo.vue?vue&type=template&id=346f054c\"\nimport script from \"./Step-photo.vue?vue&type=script&lang=js\"\nexport * from \"./Step-photo.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/baarme/develop/java/sdpo-java/src/main/frontend/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","_createElementVNode","ref","_createElementBlock","_hoisted_1","_hoisted_2","$data","loading","_hoisted_3","_hoisted_4","_normalizeClass","preview","translation","_hoisted_5","_hoisted_6","onClick","_cache","$event","$options","next","data","connection","image","mounted","this","driver","photo","$router","push","name","connect","unmounted","disconnect","computed","inspection","$store","state","methods","reader","FileReader","readAsDataURL","onloadend","setDriverPhoto","hash_id","result","split","WebSocket","onmessage","event","img","URL","createObjectURL","$refs","video","src","onopen","console","log","error","async","closeDriverPhoto","__exports__","render"],"sourceRoot":""}