"use strict";(self["webpackChunksdpo_frontend"]=self["webpackChunksdpo_frontend"]||[]).push([[799,481],{7557:function(e,t,n){n.d(t,{Z:function(){return h}});var s=n(3396);const i={class:"number-buttons",ref:"numbers"},r=(0,s._)("i",{class:"ri-close-fill"},null,-1),o=[r],a=(0,s._)("i",{class:"ri-delete-back-line"},null,-1),u=[a];function d(e,t,n,r,a,d){return(0,s.wg)(),(0,s.iD)("div",i,[(0,s._)("button",{class:"number-buttons__item",onClick:t[0]||(t[0]=e=>d.pushIntoNumber("1"))},"1"),(0,s._)("button",{class:"number-buttons__item",onClick:t[1]||(t[1]=e=>d.pushIntoNumber("2"))},"2"),(0,s._)("button",{class:"number-buttons__item",onClick:t[2]||(t[2]=e=>d.pushIntoNumber("3"))},"3"),(0,s._)("button",{class:"number-buttons__item",onClick:t[3]||(t[3]=e=>d.pushIntoNumber("4"))},"4"),(0,s._)("button",{class:"number-buttons__item",onClick:t[4]||(t[4]=e=>d.pushIntoNumber("5"))},"5"),(0,s._)("button",{class:"number-buttons__item",onClick:t[5]||(t[5]=e=>d.pushIntoNumber("6"))},"6"),(0,s._)("button",{class:"number-buttons__item",onClick:t[6]||(t[6]=e=>d.pushIntoNumber("7"))},"7"),(0,s._)("button",{class:"number-buttons__item",onClick:t[7]||(t[7]=e=>d.pushIntoNumber("8"))},"8"),(0,s._)("button",{class:"number-buttons__item",onClick:t[8]||(t[8]=e=>d.pushIntoNumber("9"))},"9"),(0,s._)("button",{class:"number-buttons__item",onClick:t[9]||(t[9]=e=>d.clearPassword())},o),(0,s._)("button",{class:"number-buttons__item",onClick:t[10]||(t[10]=e=>d.pushIntoNumber("0"))},"0"),(0,s._)("button",{class:"number-buttons__item",onClick:t[11]||(t[11]=e=>d.popIntoNumber())},u)],512)}var m={name:"InputNumber",methods:{pushIntoNumber(e){this.$emit("pushIntoNumber",e)},popIntoNumber(){this.$emit("popIntoNumber")},clearPassword(){this.$emit("clearNumber")}},mounted(){this.$refs.numbers.querySelectorAll("button").forEach(((e,t)=>{e.classList.add("animate__animated"),e.classList.add("animate__fadeInUp"),e.style.setProperty("animation-delay",.6+.05*t+"s")}))}},c=n(89);const l=(0,c.Z)(m,[["render",d]]);var h=l},9775:function(e,t,n){n.d(t,{Z:function(){return d}});var s=n(3396);function i(e,t,n,i,r,o){const a=(0,s.up)("input-number");return(0,s.wg)(),(0,s.j4)(a,{onPushIntoNumber:t[0]||(t[0]=e=>o.pushCharIntoPassword(e)),onPopIntoNumber:t[1]||(t[1]=()=>o.extractLastCharIntoPassword()),onClearNumber:t[2]||(t[2]=()=>o.clearPassword())})}var r=n(7557),o={name:"InputPersonalNumberForm",components:{InputNumber:r.Z},data(){return{password:""}},methods:{pushCharIntoPassword(e){this.password+=e},extractLastCharIntoPassword(){this.password=this.password.slice(0,-1)},clearPassword(){this.password=""},emitPass(){this.$emit("password",this.password)}},watch:{password:function(){this.emitPass()}}},a=n(89);const u=(0,a.Z)(o,[["render",i]]);var d=u},2543:function(e,t,n){n.d(t,{Z:function(){return h}});var s=n(3396),i=n(9242);const r={class:"number-form"},o=(0,s._)("div",{class:"number-form__title animate__animated animate__fadeInDown d-2"}," Введите личный номер телефона ",-1),a={class:"number-form__input"};function u(e,t,n,u,d,m){const c=(0,s.up)("input-number");return(0,s.wg)(),(0,s.iD)("div",r,[o,(0,s._)("div",a,[(0,s.wy)((0,s._)("input",{type:"text",class:"animate__animated animate__fadeIn d-5",style:{"letter-spacing":"4px"},"onUpdate:modelValue":t[0]||(t[0]=e=>d.maskNumber=e)},null,512),[[i.nr,d.maskNumber]])]),(0,s.Wm)(c,{onPushIntoNumber:t[1]||(t[1]=e=>m.pushIntoNumber(e)),onPopIntoNumber:t[2]||(t[2]=()=>m.popIntoNumber()),onClearNumber:t[3]||(t[3]=()=>m.clearNumber())})])}var d=n(7557),m={name:"InputPhoneNumber",components:{InputNumber:d.Z},props:{maskInput:{type:String,default:()=>"+7 ... ... .. .."},placeholder:{type:String,default:()=>"."}},data(){return{originNumber:"",maskNumber:"",mask:this.maskInput}},methods:{pushIntoNumber(e){this.isMaxLengthReached()||0===this.originNumber.length&&"8"===e||(this.originNumber+=e)},popIntoNumber(){this.originNumber=this.originNumber.slice(0,-1)},clearNumber(){this.originNumber=""},countOccurrences(){let e=0;for(let t=0;t<this.mask.length;t++)this.mask.charAt(t)===this.placeholder&&e++;return e},isMaxLengthReached(){return this.originNumber.length===this.countOccurrences()},replaceAt(e,t,n){return e.substr(0,t)+n+e.substr(t+n.length)},setMaskNumber(){let e=this.originNumber,t=this.mask;Array.from(e).forEach((e=>{t=this.replaceAt(t,t.indexOf("."),e)})),this.maskNumber=t.split(".").join(""),this.$emit("acceptOn",this.maskNumber.split(" ").join(""))}},watch:{originNumber:function(){this.setMaskNumber()}},mounted(){this.setMaskNumber()}},c=n(89);const l=(0,c.Z)(m,[["render",u]]);var h=l},5511:function(e,t,n){n.d(t,{Z:function(){return m}});var s=n(3396);const i={key:0,class:"admin__loading animate__animated animate__fadeInUp",style:{"z-index":"3"}},r=(0,s._)("div",{class:"lds-ring"},[(0,s._)("div"),(0,s._)("div"),(0,s._)("div"),(0,s._)("div")],-1);function o(e,t,n,o,a,u){return n.loading?((0,s.wg)(),(0,s.iD)("div",i,[r,(0,s.Uk)(" Загрузка ")])):(0,s.kq)("",!0)}var a={props:{loading:{type:Boolean,default:!1}}},u=n(89);const d=(0,u.Z)(a,[["render",o]]);var m=d},4799:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var s=n(3396),i=n(7139),r=n(9242);const o={class:"home"},a={key:0,style:{width:"100%","justify-content":"center",display:"flex"}},u=(0,s._)("div",{class:"driver-form__not-found animate__animated animate__fadeInUp"}," Работа терминала приостановлена. Проверьте подключение к интернету ",-1),d=[u],m={key:1,class:"driver-form"},c={key:0,class:"driver-form__title animate__animated animate__fadeInDown d-2"},l={key:1,class:"driver-form__title animate__animated animate__fadeInDown d-2"},h={class:"driver-form__input"},_={key:3,class:"driver-form__not-found animate__animated animate__fadeInUp"};function p(e,t,n,u,p,b){const v=(0,s.up)("medic-select"),f=(0,s.up)("input-personal-number-form");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(v),(0,s._)("div",o,[b.terminalIsLocked?((0,s.wg)(),(0,s.iD)("div",a,d)):((0,s.wg)(),(0,s.iD)("div",m,[b.inspection.driver_fio?((0,s.wg)(),(0,s.iD)("div",c,(0,i.zw)(b.inspection.driver_fio),1)):((0,s.wg)(),(0,s.iD)("div",l," Введите ваш идентификатор ")),(0,s._)("div",h,[(0,s.wy)((0,s._)("input",{type:"number",class:"animate__animated animate__fadeIn d-5","onUpdate:modelValue":t[0]||(t[0]=e=>p.driver_id=e),onInput:t[1]||(t[1]=(...e)=>b.checkDriver&&b.checkDriver(...e))},null,544),[[r.nr,p.driver_id]])]),(0,s.Wm)(f,{onPassword:t[2]||(t[2]=e=>b.updateDriverId(e))}),b.hasDriver?((0,s.wg)(),(0,s.iD)("button",{key:2,onClick:t[3]||(t[3]=(...e)=>b.start&&b.start(...e)),class:"btn animate__animated animate__fadeInUp"}," начать осмотр ")):p.error?((0,s.wg)(),(0,s.iD)("div",_,(0,i.zw)(p.error),1)):(0,s.kq)("",!0)]))])],64)}n(7658);var b=n(2227),v=n(4677);const f={key:1,class:"medics animate__animated animate__fadeInRight"},w={key:0,class:"medics__form"},g=(0,s._)("div",{class:"login-form__title"}," Введите пароль ",-1),k={class:"login-form__input"},N={class:"medics__form-selected"},I={key:1,class:"medics__select"},y={key:0,class:"medics__town"},D={class:"medics__point"},P=["onClick"];function $(e,t,n,o,a,u){const d=(0,s.up)("input-personal-number-form");return(0,s.wg)(),(0,s.iD)(s.HY,null,[u.visible?((0,s.wg)(),(0,s.iD)("div",{key:0,onClick:t[0]||(t[0]=t=>e.$store.state.selectingMedic=!1),class:"medics__overlay animate__animated animate__fadeIn"})):(0,s.kq)("",!0),u.visible?((0,s.wg)(),(0,s.iD)("div",f,["login"===a.status?((0,s.wg)(),(0,s.iD)("div",w,[g,(0,s._)("div",k,[(0,s.wy)((0,s._)("input",{type:"password","onUpdate:modelValue":t[1]||(t[1]=e=>a.password=e)},null,512),[[r.nr,a.password]])]),(0,s.Wm)(d,{onPassword:t[2]||(t[2]=e=>u.updatePassword(e))}),(0,s._)("div",N,(0,i.zw)(u.medic.name||"Сотрудник не выбран"),1)])):((0,s.wg)(),(0,s.iD)("div",I,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.towns,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:t},[e?((0,s.wg)(),(0,s.iD)("div",y,(0,i.zw)(e),1)):(0,s.kq)("",!0),e?((0,s.wg)(!0),(0,s.iD)(s.HY,{key:1},(0,s.Ko)(a.medics[e],((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:t},[(0,s._)("div",D,(0,i.zw)(t),1),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e,(e=>((0,s.wg)(),(0,s.iD)("button",{key:e.id,class:"medics__item",onClick:t=>u.select(e)},(0,i.zw)(e.name),9,P)))),128))])))),128)):(0,s.kq)("",!0)])))),128))]))])):(0,s.kq)("",!0)],64)}var C=n(9775),Z={components:{InputPersonalNumberForm:C.Z},data(){return{medics:{},towns:[],status:"login",password:""}},async mounted(){this.medics=await(0,b.oP)(),this.towns=Object.keys(this.medics).sort()},methods:{updatePassword(e){this.password=e},login(){this.password===this.config?.medic_password&&(this.password="",this.status="select")},async select(e){this.$store.state.config.main.selected_medic={name:e.name,id:e.id,eds:e.eds,validity_eds_start:e.validity_eds_start??null,validity_eds_end:e.validity_eds_end??null},this.status="login",await(0,b.sl)(this.medic)}},computed:{medic(){return this.$store.state.config?.main?.selected_medic||{}},config(){return this.$store.state.config?.main},visible(){return this.$store.state.selectingMedic}},watch:{password:function(e){this.login()}}},L=n(89);const U=(0,L.Z)(Z,[["render",$]]);var x=U,q=n(2543),A=n(6481),M=n(7625),S=n(4457),z={name:"Home",components:{InputAndSavePhone:A["default"],InputPhoneNumber:q.Z,MedicSelect:x,InputPersonalNumberForm:C.Z},data(){return{driver_id:"",error:"",toast:(0,v.pm)(),loading:!1}},methods:{async start(){const e=await(0,b.L$)(this.driver_id);if(!e)return this.driver_id="",void this.toast.error("Водитель с указаным ID не найден");this.$store.state.inspection.driver_id=e.hash_id,this.$store.state.inspection.driver_fio=e.fio,this.needSetNumberPhone?this.$router.push("/number-phone/add/"):this.$router.push({name:"step-driver"})},updateDriverId(e){this.driver_id=e},async checkDriver(){if(this.$store.state.inspection={},this.error=null,!(this.driver_id.length<6)){this.loading=!0;try{const e=await(0,b.L$)(this.driver_id);e?(this.$store.state.inspection.driver_id=e.hash_id,this.$store.state.inspection.driver_fio=e.fio,this.$store.state.driver=e,this.error=null):(this.$store.state.inspection={},this.error="Водитель не найден")}catch(e){console.log(e.response?.data?.message),this.error=e.response?.data?.message||"Неизвестная ошибка",this.$store.state.inspection={}}this.loading=!1}}},watch:{driver_id:function(e){this.checkDriver()}},computed:{terminalIsLocked(){if(!M.Z.state.connection){if(this.system.max_inspection_in_offline_mod-this.system.count_inspections<=0)return!0;let e=this.system.last_online||new Date;return(new Date-Date.parse(e))/864e5>this.system.delay_day_in_offline_mod}return!1},system(){return this.$store.state.config?.system||{}},config(){return this.$store.state.config},inspection(){return this.$store.state.inspection},hasDriver(){return this.inspection.driver_id&&!this.error},hasPhoneNumber(){return this.$store.state.driver.phone&&!this.error},needSetNumberPhone(){return(0,S.Gw)("check_phone_number")&&this.hasDriver&&!this.hasPhoneNumber&&void 0!==M.Z.state.connection}}};const H=(0,L.Z)(z,[["render",p]]);var O=H},6481:function(e,t,n){n.r(t),n.d(t,{default:function(){return h}});var s=n(3396);const i={key:0,class:"input-save-phone"};function r(e,t,n,r,o,a){const u=(0,s.up)("loader"),d=(0,s.up)("input-phone-number");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(u,{loading:o.loading,"onUpdate:loading":t[0]||(t[0]=e=>o.loading=e)},null,8,["loading"]),this.loading?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",i,[(0,s.Wm)(d,{onAcceptOn:t[1]||(t[1]=e=>a.setPhoneNumber(e))}),a.hasPhone?((0,s.wg)(),(0,s.iD)("button",{key:0,onClick:t[2]||(t[2]=e=>a.storePhone()),class:"btn animate__animated animate__fadeInUp"}," Сохранить ")):(0,s.kq)("",!0)]))],64)}n(7658);var o=n(2543),a=n(5511),u=n(2227),d=n(4677),m={name:"InputAndSavePhone",components:{Loader:a.Z,InputPhoneNumber:o.Z},data(){return{phoneNumber:"",toast:(0,d.pm)(),loading:!1}},methods:{setPhoneNumber(e){this.phoneNumber=e},formattingPhoneNumber(){return"+"===this.phoneNumber[0]?this.phoneNumber.slice(1):this.phoneNumber},async storePhone(){this.loading=!0,await(0,u.Ch)(this.formattingPhoneNumber(),this.$store.state.inspection.driver_id),this.loading=!1,this.$router.push({name:"step-driver"})}},computed:{hasPhone(){return 12===this.phoneNumber.length}}},c=n(89);const l=(0,c.Z)(m,[["render",r]]);var h=l}}]);
//# sourceMappingURL=799.cd5d844e.js.map