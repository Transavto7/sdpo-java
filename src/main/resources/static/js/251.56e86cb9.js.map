{"version":3,"file":"js/251.56e86cb9.js","mappings":"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","sources":["webpack://sdpo-frontend/./src/helpers/camera.js","webpack://sdpo-frontend/./src/helpers/media.js","webpack://sdpo-frontend/./src/pages/inspection/Step-alcometer.vue","webpack://sdpo-frontend/./src/pages/inspection/Step-alcometer.vue?12cd"],"sourcesContent":["import {defaultError} from \"@/helpers/http-errors\";\nimport {startWaitTimerRecordMedia} from \"@/helpers/media\";\nimport store from \"@/store\";\n\nexport async function makePhoto() {\n    return await axios.post(`device/photo`).then(({ data }) => {\n        return data;\n    }).catch(defaultError);\n}\n\nexport async function getSizes() {\n    return await axios.get(`device/video/size`).then(({ data }) => {\n        return data;\n    }).catch(defaultError);\n}\n\n\nexport async function makeMedia(driver_id) {\n    return await axios.post(`device/media`, {\n        driver_id,\n    }).then(({data}) => {\n        return data;\n    }).catch(defaultError);\n}\n\nexport async function stopMedia() {\n    return await axios.post(`device/media/stop`).then(async ({data}) => {\n        store.state.temp.photo = store.state.inspection.photo;\n        store.state.temp.video = store.state.inspection.video;\n        await startWaitTimerRecordMedia()\n        return data;\n    }).catch(defaultError);\n}\n\nexport async function makeVideoTest() {\n    return await axios.post(`device/video/test`).then(({ data }) => {\n        return data;\n    }).catch(defaultError);\n}","import alertPath from \"@/assets/audio/alert.ogg\";\nimport store from \"@/store\";\n\nexport function playAlert() {\n    (new Audio(alertPath)).play();\n}\n\nexport async function startWaitTimerRecordMedia() {\n    await stopWaitTimerRecordMedia();\n    let seconds = 5;\n    store.state.waitRecordMedia = true\n\n    store.state.timerRecordMedia = setInterval(() => {\n        seconds--;\n        console.log('осталось ' + seconds)\n        if (seconds < 1) {\n            stopWaitTimerRecordMedia()\n        }\n    }, 1000);\n}\n\nexport async function stopWaitTimerRecordMedia() {\n    if (store.state.waitRecordMedia) {\n        store.state.waitRecordMedia = false\n        await clearInterval(store.state.timerRecordMedia);\n    }\n\n}","<script>\nimport {\n  closeAlcometer, closeAlcometrSocket,\n  enableSlowModeAlcometer,\n  getAlcometerResult\n} from '@/helpers/alcometer';\nimport {makeMedia, stopMedia} from '@/helpers/camera';\n\nexport default {\n  data() {\n    return {\n      interval: null,\n      seconds: 5,\n      needRetry: false,\n      showRetry: false,\n      statusAlcometer: \"\",\n      statusPrev: \"prev\",\n      statusNow: \"now\",\n      recording: false\n    }\n  },\n  methods: {\n    connect() {\n      this.connection = new WebSocket(\"ws://localhost:8080/device/alcometer/status\")\n      this.connection.onmessage = async (event) => {\n        this.statusPrev = this.statusNow;\n        this.statusNow = event.data;\n      }\n\n      this.connection.onopen = (event) => {\n        console.log(\"Successfully connected to the echo websocket server...\")\n      }\n\n      this.connection.error = (error) => {\n        console.log(error);\n      }\n    },\n    async disconnect() {\n      console.log('Disconnect websoket server');\n      await closeAlcometrSocket();\n    },\n    nextStep() {\n      this.$router.push({name: 'step-sleep'});\n    },\n    async prevStep() {\n      this.$router.push({name: 'step-thermometer'});\n    },\n    hasResult(result) {\n      return !(result === undefined || result === null || result === 'next');\n    },\n    runCountdown() {\n      this.seconds = 5;\n      this.timerInterval = setInterval(() => {\n        this.seconds--;\n        if (this.seconds < 1) {\n          clearInterval(this.timerInterval);\n        }\n      }, 1000);\n    },\n  },\n  async mounted() {\n    await enableSlowModeAlcometer();\n    await closeAlcometer();\n    this.connect()\n    this.runCountdown()\n\n    this.requestInterval = setInterval(async () => {\n      const result = await getAlcometerResult();\n\n      if (!this.hasResult(result)) {\n        return;\n      }\n\n      this.inspection.alcometer_result = Number(result) || 0;\n      this.inspection.alcometer_mode = '1';\n      this.nextStep();\n    }, 700);\n  },\n  unmounted() {\n    this.disconnect()\n    clearInterval(this.requestInterval);\n    clearInterval(this.timerInterval);\n  },\n  computed: {\n    inspection() {\n      return this.$store.state.inspection;\n    },\n    identifier() {\n      return this.$store.state.inspection.driver_id || this.$store.state.inspection.person_id;\n    },\n    system() {\n      return this.$store.state.config?.system || {};\n    },\n  },\n}\n</script>\n<template>\n  <div class=\"step-alcometer__outer\">\n    <div class=\"step-alcometer\">\n      <h3  class=\"animate__animated animate__fadeInDown\">Количественное определение алкоголя</h3>\n      <div  class=\"step-alcometer__items\">\n        <div class=\"step-alcometer__item animate__animated animate__fadeInUp d-1\">\n          <span style=\"min-height: 30px\">3</span>\n          <img style=\"padding-right: 20px\" width=\"80\" src=\"@/assets/images/precise.png\">\n          Установите мундштук\n        </div>\n        <div class=\"step-alcometer__text  animate__animated animate__fadeInUp d-2\">\n          Установите индивидуальный мундштук<br><br>\n          Дождитесь ГОТОВ на экране алкометра<br><br>\n          Начните дуть с умеренной силой до<br>\n          окончания звукового сигнала.<br><br>\n          Снимите индивидуальный мундштук<br><br>\n        </div>\n      </div>\n    </div>\n    <div class=\"step-buttons\">\n      <button @click=\"prevStep()\" class=\"btn opacity blue\">Назад</button>\n      <button @click=\"$router.push({ name: 'step-sleep' })\" class=\"btn\">Продолжить</button>\n    </div>\n  </div>\n</template>\n","import { render } from \"./Step-alcometer.vue?vue&type=template&id=0aa30fb4\"\nimport script from \"./Step-alcometer.vue?vue&type=script&lang=js\"\nexport * from \"./Step-alcometer.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/baarme/develop/java/sdpo-java/src/main/frontend/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["async","makePhoto","axios","post","then","data","catch","defaultError","getSizes","get","makeMedia","driver_id","stopMedia","store","startWaitTimerRecordMedia","makeVideoTest","playAlert","Audio","alertPath","play","stopWaitTimerRecordMedia","seconds","setInterval","console","log","clearInterval","class","_createElementBlock","_hoisted_1","_hoisted_2","_createElementVNode","_hoisted_3","onClick","_cache","$event","$options","prevStep","_ctx","$router","push","name","interval","needRetry","showRetry","statusAlcometer","statusPrev","statusNow","recording","methods","connect","this","connection","WebSocket","onmessage","event","onopen","error","closeAlcometrSocket","nextStep","hasResult","result","undefined","runCountdown","timerInterval","enableSlowModeAlcometer","closeAlcometer","requestInterval","getAlcometerResult","inspection","alcometer_result","Number","alcometer_mode","unmounted","disconnect","computed","$store","state","identifier","person_id","system","config","__exports__","render"],"sourceRoot":""}