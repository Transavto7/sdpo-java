"use strict";(self["webpackChunksdpo_frontend"]=self["webpackChunksdpo_frontend"]||[]).push([[273],{5511:function(t,e,i){i.d(e,{Z:function(){return c}});var n=i(3396);const r={key:0,class:"admin__loading animate__animated animate__fadeInUp",style:{"z-index":"3"}},s=(0,n._)("div",{class:"lds-ring"},[(0,n._)("div"),(0,n._)("div"),(0,n._)("div"),(0,n._)("div")],-1);function a(t,e,i,a,o,d){return i.loading?((0,n.wg)(),(0,n.iD)("div",r,[s,(0,n.Uk)(" Загрузка ")])):(0,n.kq)("",!0)}var o={props:{loading:{type:Boolean,default:!1}}},d=i(89);const l=(0,d.Z)(o,[["render",a]]);var c=l},273:function(t,e,i){i.r(e),i.d(e,{default:function(){return Y}});var n=i(3396);function r(t,e,i,r,s,a){const o=(0,n.up)("print-login"),d=(0,n.up)("print-index"),l=(0,n.up)("loader");return(0,n.wg)(),(0,n.iD)(n.HY,null,[this.login||this.loading?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(o,{key:0,onSuccessAuth:e[0]||(e[0]=t=>a.setDriver(t))})),this.login&&!this.loading?((0,n.wg)(),(0,n.j4)(d,{key:1,onPrint:e[1]||(e[1]=t=>a.printQuery(t)),onPrintQr:e[2]||(e[2]=t=>a.printQueryQr(t)),inspections:s.inspections,"onUpdate:inspections":e[3]||(e[3]=t=>s.inspections=t),driver:s.driver,"onUpdate:driver":e[4]||(e[4]=t=>s.driver=t)},null,8,["inspections","driver"])):(0,n.kq)("",!0),(0,n.Wm)(l,{loading:s.loading,"onUpdate:loading":e[5]||(e[5]=t=>s.loading=t)},null,8,["loading"])],64)}i(7658);var s=i(7139),a=i(9242);const o={class:"home"},d={class:"driver-form"},l={key:0,class:"driver-form__title animate__animated animate__fadeInDown d-2"},c={key:1,class:"driver-form__title animate__animated animate__fadeInDown d-2"},u={class:"driver-form__input"},h={key:2,class:"driver-form__not-found animate__animated animate__fadeInUp"};function _(t,e,i,r,_,p){const m=(0,n.up)("input-personal-number-form");return(0,n.wg)(),(0,n.iD)("div",o,[(0,n._)("div",d,[_.driver.driver_fio?((0,n.wg)(),(0,n.iD)("div",l,(0,s.zw)(_.driver.driver_fio),1)):((0,n.wg)(),(0,n.iD)("div",c," Введите ваш идентификатор ")),(0,n._)("div",u,[(0,n.wy)((0,n._)("input",{type:"number",class:"animate__animated animate__fadeIn d-5","onUpdate:modelValue":e[0]||(e[0]=t=>_.driver_id=t),onInput:e[1]||(e[1]=(...t)=>p.checkDriver&&p.checkDriver(...t))},null,544),[[a.nr,_.driver_id]])]),(0,n.Wm)(m,{onPassword:e[2]||(e[2]=t=>p.updateDriverId(t))}),_.error?((0,n.wg)(),(0,n.iD)("div",h,(0,s.zw)(_.error),1)):(0,n.kq)("",!0)])])}var p=i(9775),m=i(2227),v=i(4677),g={components:{InputPersonalNumberForm:p.Z},data(){return{driver_id:"",driver:{},error:"",toast:(0,v.pm)(),loading:!1}},methods:{async start(){this.$emit("success-auth",this.driver)},updateDriverId(t){this.driver_id=t},async checkDriver(){if(this.error=null,!(this.driver_id.length<6)){this.loading=!0;try{const t=await(0,m.L$)(this.driver_id);t?(this.driver=t,this.error=null,await this.start()):this.error="Водитель не найден"}catch(t){this.error=t.response?.data?.message||"Неизвестная ошибка"}this.loading=!1}}},watch:{driver_id:function(t){this.checkDriver(),this.hasDriver||(this.processingApproval=!1)}},computed:{config(){return this.$store.state.config},hasDriver(){return this.driver.driver_id&&!this.error}},mounted(){}},f=i(89);const w=(0,f.Z)(g,[["render",_]]);var D=w;const k={class:"last-inspection"},y={class:"last-inspection__header"},I={class:"last-inspection_body"},b={class:"content-block__calendar"},P={key:0,class:"content-block__table"},Q=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",{style:{width:"40%"}},"Дата Время"),(0,n._)("th",null,"Тип осмотра"),(0,n._)("th"),(0,n._)("th")])],-1),U={class:"animate__animated animate__fadeInUp"},q={class:"animate__animated animate__fadeInUp"},F={class:"time"},Z=["onClick"],$=(0,n._)("i",{class:"ri-printer-fill"},null,-1),x=[$],S=["onClick"],z=(0,n._)("i",{class:"ri-qr-code-line"},null,-1),C=[z],V={key:1,class:"content-block__warning"},L=(0,n._)("div",{class:"driver-form__not-found animate__animated animate__fadeInUp"},"Осмотры на выбранную дату не проводились ",-1),j=[L];function M(t,e,i,r,a,o){const d=(0,n.up)("VueDatePicker");return(0,n.wg)(),(0,n.iD)("div",k,[(0,n._)("div",y,[(0,n._)("h1",null,(0,s.zw)(i.driver.fio),1)]),(0,n._)("div",I,[(0,n._)("div",b,[(0,n.Wm)(d,{modelValue:a.date,"onUpdate:modelValue":e[0]||(e[0]=t=>a.date=t),inline:"","auto-apply":"","disable-year-select":!0,locale:"ru","hide-navigation":["month","time","hours","seconds"],"min-date":o.firstDayLastMonth,"max-date":o.dateNow,"prevent-min-max-navigation":"",markers:a.dateFiltered},null,8,["modelValue","min-date","max-date","markers"])]),o.hasSelectInspections?((0,n.wg)(),(0,n.iD)("div",P,[(0,n._)("table",null,[Q,(0,n._)("tbody",U,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(this.inspectionsFiltered,(t=>((0,n.wg)(),(0,n.iD)("tr",q,[(0,n._)("td",F,(0,s.zw)(o.getTimeOnly(t.created_at)),1),(0,n._)("td",null,(0,s.zw)(t.type_view),1),(0,n._)("td",null,[(0,n._)("a",{class:"btn icon",onClick:e=>o.print(t)},x,8,Z)]),(0,n._)("td",null,[o.connection?((0,n.wg)(),(0,n.iD)("a",{key:0,class:"btn icon",onClick:e=>o.printQr(t)},C,8,S)):(0,n.kq)("",!0)])])))),256))])])])):(0,n.kq)("",!0),o.hasSelectInspections?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",V,j))])])}var N=i(7190),O={components:{VueDatePicker:N.Z},props:{inspections:{type:Object,require:!0,default:()=>({})},driver:{type:Object,require:!0}},data(){return{date:new Date,inspectionsFiltered:[],dateFiltered:[]}},methods:{getTimeOnly(t){return new Date(t).toTimeString().split(" ")[0]},print(t){this.$emit("print",t)},printQr(t){this.$emit("printQr",t)},initDateRange(){if(this.hasInspections)for(const t of this.inspections)this.dateFiltered.push({date:t.created_at,type:"line",color:"red"})}},watch:{date(){if(this.inspectionsFiltered=[],this.hasInspections)for(const t of this.inspections)new Date(t.created_at).toDateString()===new Date(this.date).toDateString()&&this.inspectionsFiltered.push(t)}},computed:{connection(){return this.$store.state.connection||!1},dateNow(){return new Date},firstDayLastMonth(){let t=new Date;return t.setMonth(t.getMonth()-1,1),t},hasSelectInspections(){return this.inspectionsFiltered.length>0},hasInspections(){return this.inspections.length>0}},mounted(){this.initDateRange(),this.date=this.dateNow},unmounted(){}};const A=(0,f.Z)(O,[["render",M]]);var H=A,T=i(5511),W={components:{Loader:T.Z,PrintIndex:H,PrintLogin:D},data(){return{driver:null,toast:(0,v.pm)(),inspections:{},print:!1,errorAuthentication:!1,loading:!1}},methods:{async confirmPrint(t){await(0,m.xH)(t),this.toast.success("Задание на печать отправлено"),this.$router.push("/")},async confirmPrintQr(t){await(0,m.iG)(t),this.toast.success("Задание на печать отправлено"),this.$router.push("/")},printQuery(t){this.confirmPrint(t)},printQueryQr(t){this.confirmPrintQr(t)},async setDriver(t){this.loading=!0,this.inspections=await(0,m.vs)(t.hash_id),this.driver=t,this.loading=!1}},computed:{login(){return null!==this.driver}}};const R=(0,f.Z)(W,[["render",r]]);var Y=R}}]);
//# sourceMappingURL=273.c1c80fa2.js.map